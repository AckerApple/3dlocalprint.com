import"./version-CmGDf4Ws.js";import{t as L,S as I,J as O,F as B,D as N,E as P,j as c,I as C,v as S,q as m,K as s,L as n,M as x,X as z,N as D,O as j,P as y,Q as M,R as q,W as k,T as J,U as K,V as Q,Y as V}from"./debug-B1Ny23UT.js";let w=document.getElementById("manufacturersApp");const i={current:w},r=C.map(a=>a);let f="",u=null,p=!1,v=!1;const E=()=>{i.current&&(i.current.replaceChildren(),k(T,i.current))},W=()=>{const a=f.trim();a&&(r.push(a),f="",E())},X=a=>{r.splice(a,1),E()},Y=async()=>{if(!p){s.error("Sign in to save changes.");return}try{await V(r.map(a=>a)),s.success("Manufacturers saved.")}catch(a){console.error("Failed to save manufacturers",a),s.error("Save failed. Try again.")}},F=()=>O().catch(a=>{console.error("Firebase sign-out failed",a),s.error("Sign out failed. Try again.")}),T=L(()=>[I(F),B.class`panel manufacturers-panel`(N("Manage Manufacturers"),P("Update the list used by the swatch editor and add new entries."),c.class`manufacturer-list`(...r.map((a,e)=>c.class`manufacturer-row`(S({class:"manufacturer-input",type:"text",value:()=>r[e]??"",onInput:o=>{r[e]=o.target.value}}),m({type:"button",class:"ghost-button",onClick:()=>X(e)},"Remove")))),c.class`manufacturer-add`(S({class:"manufacturer-input",type:"text",placeholder:"New manufacturer",value:()=>f,onInput:a=>{f=a.target.value}}),m({type:"button",class:"add-button",onClick:W},"âž• Add manufacturer")),c.class`auth-actions`(m({type:"button",class:"add-button",onClick:Y},"ðŸ’¾ Save to Firestore")))]),U=()=>{if(n("mountApp",{reason:"manufacturers"}),!i.current||v)return;const a=Q(i);a&&(a.replaceChildren(),k(T,a),v=!0,w=i.current)},d=(a,e,o="")=>{n("mountSso",{status:a,userEmail:e,reason:o}),i.current&&(x({rootRef:i,status:a,userEmail:e,adminEmail:"",onSignIn:()=>z().catch(t=>{console.error("Firebase sign-in failed",t),s.error("Sign in failed. Try again.")}),onSignOut:F,setAppMounted:t=>{v=t}}),w=i.current)};d("loading","","initial");const l=async(a,e="")=>{if(n("auth:changed",{userEmail:(a==null?void 0:a.email)||null,reason:e}),p=!1,!a){u&&(u(),u=null),d("login","","auth:logged-out");return}let o=!1;try{o=await J(a.email||"")}catch(t){console.error("Failed to load admin list",t),s.error("Unable to verify access. Check Firestore rules."),d("denied",a.email||"","auth:permissions");return}if(!o){u&&(u(),u=null),s.error(`Signed in as ${a.email||"unknown"} but not authorized.`),d("denied",a.email||"","auth:denied");return}p=!0,u||(u=K(t=>{Array.isArray(t)&&t.length?r.splice(0,r.length,...t):r.splice(0,r.length,...C),p&&U()})),U()},$=async()=>{D(),n("page:load",{path:window.location.pathname}),window.addEventListener("pageshow",a=>{n("page:pageshow",{persisted:a.persisted})}),window.addEventListener("pagehide",a=>{n("page:pagehide",{persisted:a.persisted})}),window.addEventListener("visibilitychange",()=>{n("page:visibility",{state:document.visibilityState})}),j().then(({redirectError:a,redirectResult:e,persistence:o})=>{var t;if(a&&s.error("Sign-in failed after redirect. Try again."),n("auth:persistence",o),o.error&&s.error("Safari blocked login storage. Check cookie settings."),y("after prepareAuth"),n("auth:redirectResult",{hasUser:!!(e!=null&&e.user),email:((t=e==null?void 0:e.user)==null?void 0:t.email)||""}),y("after redirectResult"),e!=null&&e.user&&l(e.user,"redirectResult"),!(e!=null&&e.user)){const b=M();if(b)l(b,"currentUser");else{let h=0;const A=()=>{h+=1;const g=M();if(n("auth:retry",{attempt:h,hasUser:!!g}),g){l(g,"currentUser:retry");return}h<8&&window.setTimeout(A,500)};window.setTimeout(A,500)}}}).catch(a=>{console.error("Failed to prepare auth",a),s.error("Sign-in setup failed. Try again.")}),q(a=>{l(a,"onAuthChanged"),y("after onAuthChanged")})};$();
