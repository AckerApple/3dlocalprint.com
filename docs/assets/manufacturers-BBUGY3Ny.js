import"./version-DMCItF73.js";import{t as T,S as L,J as I,F as k,D as O,E as B,j as c,I as M,v as b,q as m,K as o,L as s,M as N,W as x,N as z,O as D,P as S,Q as P,V as U,R as j,T as q,U as J,X as K}from"./debug-88wQiJZN.js";let v=document.getElementById("manufacturersApp");const i={current:v},n=M.map(a=>a);let f="",u=null,p=!1,y=!1;const C=()=>{i.current&&(i.current.replaceChildren(),U(F,i.current))},Q=()=>{const a=f.trim();a&&(n.push(a),f="",C())},V=a=>{n.splice(a,1),C()},W=async()=>{if(!p){o.error("Sign in to save changes.");return}try{await K(n.map(a=>a)),o.success("Manufacturers saved.")}catch(a){console.error("Failed to save manufacturers",a),o.error("Save failed. Try again.")}},E=()=>I().catch(a=>{console.error("Firebase sign-out failed",a),o.error("Sign out failed. Try again.")}),F=T(()=>[L(E),k.class`panel manufacturers-panel`(O("Manage Manufacturers"),B("Update the list used by the swatch editor and add new entries."),c.class`manufacturer-list`(...n.map((a,e)=>c.class`manufacturer-row`(b({class:"manufacturer-input",type:"text",value:()=>n[e]??"",onInput:r=>{n[e]=r.target.value}}),m({type:"button",class:"ghost-button",onClick:()=>V(e)},"Remove")))),c.class`manufacturer-add`(b({class:"manufacturer-input",type:"text",placeholder:"New manufacturer",value:()=>f,onInput:a=>{f=a.target.value}}),m({type:"button",class:"add-button",onClick:Q},"âž• Add manufacturer")),c.class`auth-actions`(m({type:"button",class:"add-button",onClick:W},"ðŸ’¾ Save to Firestore")))]),A=()=>{if(s("mountApp",{reason:"manufacturers"}),!i.current||y)return;const a=J(i);a&&(a.replaceChildren(),U(F,a),y=!0,v=i.current)},d=(a,e,r="")=>{s("mountSso",{status:a,userEmail:e,reason:r}),i.current&&(N({rootRef:i,status:a,userEmail:e,adminEmail:"",onSignIn:()=>x().catch(t=>{console.error("Firebase sign-in failed",t),o.error("Sign in failed. Try again.")}),onSignOut:E,setAppMounted:t=>{y=t}}),v=i.current)};d("loading","","initial");const l=async(a,e="")=>{if(s("auth:changed",{userEmail:(a==null?void 0:a.email)||null,reason:e}),p=!1,!a){u&&(u(),u=null),d("login","","auth:logged-out");return}let r=!1;try{r=await j(a.email||"")}catch(t){console.error("Failed to load admin list",t),o.error("Unable to verify access. Check Firestore rules."),d("denied",a.email||"","auth:permissions");return}if(!r){u&&(u(),u=null),o.error(`Signed in as ${a.email||"unknown"} but not authorized.`),d("denied",a.email||"","auth:denied");return}p=!0,u||(u=q(t=>{Array.isArray(t)&&t.length?n.splice(0,n.length,...t):n.splice(0,n.length,...M),p&&A()})),A()},X=async()=>{z(),s("page:load",{path:window.location.pathname}),window.addEventListener("pageshow",a=>{s("page:pageshow",{persisted:a.persisted})}),window.addEventListener("pagehide",a=>{s("page:pagehide",{persisted:a.persisted})}),window.addEventListener("visibilitychange",()=>{s("page:visibility",{state:document.visibilityState})}),D().then(({redirectError:a,redirectResult:e})=>{var r;if(a&&o.error("Sign-in failed after redirect. Try again."),s("auth:redirectResult",{hasUser:!!(e!=null&&e.user),email:((r=e==null?void 0:e.user)==null?void 0:r.email)||""}),e!=null&&e.user&&l(e.user,"redirectResult"),!(e!=null&&e.user)){const t=S();if(t)l(t,"currentUser");else{let h=0;const w=()=>{h+=1;const g=S();if(s("auth:retry",{attempt:h,hasUser:!!g}),g){l(g,"currentUser:retry");return}h<8&&window.setTimeout(w,500)};window.setTimeout(w,500)}}}).catch(a=>{console.error("Failed to prepare auth",a),o.error("Sign-in setup failed. Try again.")}),P(a=>{l(a,"onAuthChanged")})};X();
