import"./version-DY3vLLu-.js";import{t as k,u as w,g as F,f as U,p as I,d as u,i as h,b as d,v as t,w as T,D as E,x as R,y as x,C as b,z,K as B,B as L,R as O}from"./toast-Dm6QH7Hm.js";import{A as D}from"./AdminNav.tag-BK0PKYst.js";import"./adminNavItems-u5BZOrdS.js";const A=["Bambu","PolyMaker","Hatchbox","3DHoJor"];let g=document.getElementById("manufacturersApp");const o={current:g},r=A.map(e=>e);let f="",s=null,l=!1,p=!1,m=null;const M=()=>{o.current&&(o.current.replaceChildren(),b(C,o.current))},H=()=>{const e=f.trim();e&&(r.push(e),f="",M())},N=e=>{r.splice(e,1),M()},P=async()=>{if(!l){t.error("Sign in to save changes.");return}try{await O(r.map(e=>e)),t.success("ðŸ­ Manufacturers saved.")}catch(e){console.error("Failed to save ðŸ­ manufacturers",e),t.error("Save failed. Try again.")}},S=()=>w().catch(e=>{console.error("Firebase sign-out failed",e),t.error("Sign out failed. Try again.")}),C=k(()=>[D(S,m),F.class`panel manufacturers-panel`(U("ðŸ­ Manage Filament Manufacturers"),I("Update the list used by the filament inventory and add new entries."),u.class`manufacturer-list`(...r.map((e,a)=>u.class`manufacturer-row`(h({class:"manufacturer-input",type:"text",value:()=>r[a]??"",onInput:i=>{r[a]=i.target.value}}),d({type:"button",class:"ghost-button",onClick:()=>N(a)},"Remove")))),u.class`manufacturer-add`(h({class:"manufacturer-input",type:"text",placeholder:"New ðŸ­ manufacturer",value:()=>f,onInput:e=>{f=e.target.value}}),d({type:"button",class:"add-button",onClick:H},"âž• Add ðŸ­ manufacturer")),u.class`auth-actions`(d({type:"button",class:"add-button",onClick:P},"ðŸ’¾ Save to Firestore")))]),y=()=>{if(!o.current||p)return;const e=L(o);e&&(e.replaceChildren(),b(C,e),p=!0,g=o.current)},c=(e,a,i="")=>{o.current&&(T({rootRef:o,status:e,userEmail:a,adminEmail:"",onSignIn:()=>E().catch(n=>{console.error("Firebase sign-in failed",n),t.error("Sign in failed. Try again.")}),onSignOut:S,setAppMounted:n=>{p=n}}),g=o.current)};c("loading","","initial");const v=async(e,a="")=>{if(l=!1,!e){m=null,s&&(s(),s=null),c("login","","auth:logged-out");return}m={email:e.email||"",photoURL:e.photoURL||""};let i=!1;try{i=await z(e.email||"")}catch(n){console.error("Failed to load admin list",n),t.error("Unable to verify access. Check Firestore rules."),c("denied",e.email||"","auth:permissions");return}if(!i){s&&(s(),s=null),t.error(`Signed in as ${e.email||"unknown"} but not authorized.`),c("denied",e.email||"","auth:denied");return}l=!0,s||(s=B(n=>{Array.isArray(n)&&n.length?r.splice(0,r.length,...n):r.splice(0,r.length,...A),l&&y()})),y()},J=async()=>{R().then(({redirectError:e,redirectResult:a,persistence:i})=>{e&&t.error("Sign-in failed after redirect. Try again."),i.error&&t.error("Safari blocked login storage. Check cookie settings."),a!=null&&a.user&&v(a.user,"redirectResult")}).catch(e=>{console.error("Failed to prepare auth",e),t.error("Sign-in setup failed. Try again.")}),x(e=>{v(e,"onAuthChanged")})};J();
