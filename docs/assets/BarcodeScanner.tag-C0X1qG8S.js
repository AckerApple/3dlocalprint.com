import{F as A,t as S,o as b,J as D,d as m,s as I,I as E}from"./auth-handler-CbhqdzIw.js";const F=A("video"),k=S(({onResult:o,formats:s})=>{k.updates(e=>{[{onResult:o,formats:s}]=e,o=b(o||(()=>{}))}),o=b(o||(()=>{}));const q=Array.isArray(s)&&s.length?s:["code_128","code_39","code_93","ean_13","ean_8","itf","upc_a","upc_e","qr_code"];let f="Idle.",i="",p="",l=null,n=null,d=null;const g=`barcodePreview-${Math.random().toString(36).slice(2,9)}`,r=e=>{console.log("[barcode] status:",e),f=e},v=(e,t)=>{i=e,p=t||""},w=()=>{d&&(cancelAnimationFrame(d),d=null),n&&(n.getTracks().forEach(e=>e.stop()),n=null),l=null,r("Camera stopped.")},B=e=>{try{o(e)}catch(t){console.error("[barcode] onResult failed",t)}},y=async e=>{if(!(!l||!n)){try{if(e.readyState>=HTMLMediaElement.HAVE_ENOUGH_DATA){const t=await l.detect(e);if(t.length>0){const[a]=t,c=a.rawValue||"",u=a.format||"";c&&B(c),v(c||"(no data)",u),r("Barcode detected.")}else r("Scanning...")}}catch(t){const a=new Error("Barcode scan loop error").stack;console.error("[barcode] scan loop stack trace",a),r(`Scan error: ${t.message||t}`)}d=requestAnimationFrame(()=>y(e))}},_=async()=>{if(!("BarcodeDetector"in window)){r("BarcodeDetector API is not supported in this browser.");return}try{r("Requesting camera access...");const e=await new Promise(t=>{let a=0;const c=()=>{const u=document.getElementById(g);if(u)return t(u);if(a+=1,a>60)return t(null);requestAnimationFrame(c)};c()});if(!e){r("Barcode preview not ready.");return}l=new BarcodeDetector({formats:q}),n=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}),e.srcObject=n,await e.play(),r("Scanning..."),y(e)}catch(e){console.error("[barcode] camera error:",e),r(`Camera error: ${e.message||e}`),w()}};D(()=>{w(),console.log("ðŸ”´ stop barcode scanner tag destroyed")}),_();const h=()=>i?p?`${i}

format: ${p}`:i:"";return m({class:"qr-panel"},m({class:"qr-preview"},F({id:g,playsInline:!0,muted:!0})),m({class:"qr-output"},I({class:"qr-label"},"Barcode Data"),E({class:"qr-text"},()=>h()||"(no scan yet)")),m({class:"qr-status"},()=>f))});export{k as B};
