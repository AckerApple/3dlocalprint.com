import"./version-DY3vLLu-.js";import{t as w,u as k,g as F,f as T,p as U,d as l,i as A,b as p,v as n,w as E,D as L,x as I,y as M,C as b,z as R,S as z,B as O,T as B}from"./toast-Dm6QH7Hm.js";import{A as N}from"./AdminNav.tag-BK0PKYst.js";import"./adminNavItems-u5BZOrdS.js";let g=document.getElementById("adminsApp");const s={current:g},t=[];let d="",i=null,c=!1,m=!1,f=null;const h=()=>{s.current&&(s.current.replaceChildren(),b(C,s.current))},_=()=>{const e=d.trim().toLowerCase();if(!e){n.error("Enter an email address.");return}if(t.some(a=>a.toLowerCase()===e)){n.error("That admin is already listed.");return}t.push(e),d="",h()},$=e=>{const a=t[e]||"";confirm(`Remove admin ${a}?`)&&(t.splice(e,1),h())},D=async()=>{if(!c){n.error("Sign in to save changes.");return}try{await B(t.map(e=>e)),n.success("Admins saved.")}catch(e){console.error("Failed to save admins",e),n.error("Save failed. Try again.")}},S=()=>k().catch(e=>{console.error("Firebase sign-out failed",e),n.error("Sign out failed. Try again.")}),C=w(()=>[N(S,f),F.class`panel manufacturers-panel`(T("Manage Admins"),U("Update the list of emails allowed to access the filament tools."),l.class`manufacturer-list`(...t.map((e,a)=>l.class`manufacturer-row`(A.class`manufacturer-input`.type`email`.value(o=>t[a]??"").onInput(o=>{t[a]=o.target.value.trim().toLowerCase()})(),p.type`button`.class`ghost-button`.onClick(()=>$(a))("Remove")))),l.class`manufacturer-add`(A.class`manufacturer-input`.type`email`.attr("placeholder","New admin email").value(e=>d).onInput(e=>{d=e.target.value})(),p.type`button`.class`add-button`.onClick(_)("âž• Add admin")),l.class`auth-actions`(p.type`button`.class`add-button`.onClick(D)("ðŸ’¾ Save to Firestore")))]),y=()=>{if(!s.current||m)return;const e=O(s);e&&(e.replaceChildren(),b(C,e),m=!0,g=s.current)},u=(e,a,o="")=>{E({rootRef:s,status:e,userEmail:a,adminEmail:"",onSignIn:()=>L().catch(r=>{console.error("Firebase sign-in failed",r),n.error("Sign in failed. Try again.")}),onSignOut:S,setAppMounted:r=>{m=r}}),g=s.current};u("loading","","initial");const v=async(e,a="")=>{if(c=!1,!e){f=null,i&&(i(),i=null),u("login","","auth:logged-out");return}f={email:e.email||"",photoURL:e.photoURL||""};let o=!1;try{o=await R(e.email||"")}catch(r){console.error("Failed to load admin list",r),n.error("Unable to verify access. Check Firestore rules."),u("denied",e.email||"","auth:permissions");return}if(!o){i&&(i(),i=null),n.error(`Signed in as ${e.email||"unknown"} but not authorized.`),u("denied",e.email||"","auth:denied");return}c=!0,i||(i=z(r=>{Array.isArray(r)&&r.length?t.splice(0,t.length,...r):t.splice(0,t.length),c&&(m?h():y())})),y()},P=async()=>{I().then(({redirectError:e,redirectResult:a,persistence:o})=>{e&&n.error("Sign-in failed after redirect. Try again."),o.error&&n.error("Safari blocked login storage. Check cookie settings."),a!=null&&a.user&&v(a.user,"redirectResult")}).catch(e=>{console.error("Failed to prepare auth",e),n.error("Sign-in setup failed. Try again.")}),M(e=>{v(e,"onAuthChanged")})};P();
