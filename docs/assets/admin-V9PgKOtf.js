import"./version-DY3vLLu-.js";import{t as f,g as A,d as i,b as y,u as b,f as S,p as d,e as U,j as C,v as o,w as v,D as k,x as E,y as w,z as F,B as j,C as I,E as L,s as h}from"./toast-Dm6QH7Hm.js";import{a as M,w as u}from"./adminNavItems-u5BZOrdS.js";let c=document.getElementById("adminHomeApp");const r={current:c};let l=!1,m=null;const R=a=>{if(!(a!=null&&a.email))return null;const e=a.photoURL?L({class:"user-avatar-image",src:a.photoURL,alt:a.email,referrerPolicy:"no-referrer"}):h.class`user-avatar-fallback`((a.email||"?")[0].toUpperCase());return i.class`user-badge`(e,h.class`user-email`(a.email))},p=()=>b().catch(a=>{console.error("Firebase sign-out failed",a),o.error("Sign out failed. Try again.")}),T=f(()=>[A.class`admin-home`(i.class`admin-home-top`(R(m),y.type`button`.class`menu-button admin-home-signout`.onClick(p)("ðŸšª Sign out")),i.class`admin-home-header`(S("Admin Home"),d("Choose an admin area to get started.")),i.class`admin-home-grid`(...M.map(a=>U.class`panel admin-home-card`.href(a.href)(i.class`admin-home-emoji`(a.emoji),C(u(a.label)),d(u(a.details))))))]),H=()=>{if(!r.current||l)return;const a=j(r);a&&(a.replaceChildren(),I(T,a),l=!0,c=r.current)},s=(a,e,n="")=>{r.current&&(v({rootRef:r,status:a,userEmail:e,adminEmail:"",onSignIn:()=>k().catch(t=>{console.error("Firebase sign-in failed",t),o.error("Sign in failed. Try again.")}),onSignOut:p,setAppMounted:t=>{l=t}}),c=r.current)};s("loading","","initial");const g=async(a,e="")=>{if(!a){m=null,s("login","","auth:logged-out");return}m={email:a.email||"",photoURL:a.photoURL||""};let n=!1;try{n=await F(a.email||"")}catch(t){console.error("Failed to load admin list",t),o.error("Unable to verify access. Check Firestore rules."),s("denied",a.email||"","auth:permissions");return}if(!n){s("denied",a.email||"","auth:denied");return}H()},O=async()=>{E().then(({redirectError:a,redirectResult:e,persistence:n})=>{a&&o.error("Sign-in failed after redirect. Try again."),n!=null&&n.error&&o.error("Safari blocked login storage. Check cookie settings."),e!=null&&e.user&&g(e.user,"redirectResult")}).catch(a=>{console.error("Failed to prepare auth",a),o.error("Sign-in setup failed. Try again.")}),w(a=>{g(a,"onAuthChanged")})};O();
