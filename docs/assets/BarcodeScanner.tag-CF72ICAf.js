import{M as A,t as f,o as D,Q as M,d as m,s as T,P as k}from"./auth-handler-C4naTd7l.js";const I=A("video"),v=a=>a instanceof Error?a.message:String(a),F=f(({onResult:a,formats:l}={})=>{F.inputs(e=>{[{onResult:a,formats:l}={}]=e,a=D(a)});const S=Array.isArray(l)&&l.length?l:["code_128","code_39","code_93","ean_13","ean_8","itf","upc_a","upc_e","qr_code"];let g="Idle.",s="",p="",i=null,n=null,d=null;const w=`barcodePreview-${Math.random().toString(36).slice(2,9)}`,r=e=>{console.log("[barcode] status:",e),g=e},q=(e="",t="")=>{s=e||"",p=t||"",console.log("SET!",{lastText:s})},y=()=>{d&&(cancelAnimationFrame(d),d=null),n&&(n.getTracks().forEach(e=>e.stop()),n=null),i=null,r("Camera stopped.")},B=f.callback(e=>{try{a(e)}catch(t){console.error("[barcode] onResult failed",t)}}),_=async e=>{if(!(!i||!n)){try{if(e.readyState>=HTMLMediaElement.HAVE_ENOUGH_DATA){const t=await i.detect(e);if(t.length>0){const[o]=t,c=o.rawValue||"",u=o.format||"";c&&B(c),q(c||"(no data)",u),r("Barcode detected.")}else r("Scanning...")}}catch(t){const o=new Error("Barcode scan loop error").stack;console.error("[barcode] scan loop stack trace",o),r(`Scan error: ${v(t)}`)}d=requestAnimationFrame(()=>_(e))}},E=async()=>{const e=window.BarcodeDetector;if(!e){r("BarcodeDetector API is not supported in this browser.");return}try{r("Requesting camera access...");const t=await new Promise(o=>{let c=0;const u=()=>{const b=document.getElementById(w);if(b instanceof HTMLVideoElement)return o(b);if(c+=1,c>60)return o(null);requestAnimationFrame(u)};u()});if(!t){r("Barcode preview not ready.");return}i=new e({formats:S}),n=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}),t.srcObject=n,await t.play(),r("Scanning..."),_(t)}catch(t){console.error("[barcode] camera error:",t),r(`Camera error: ${v(t)}`),y()}};M(()=>{y(),console.log("ðŸ”´ stop barcode scanner tag destroyed")}),f.promise=E();const h=()=>s?p?`${s}

format: ${p}`:s:"";return m({class:"qr-panel"},m({class:"qr-preview"},I({id:w,playsInline:!0,muted:!0})),m({class:"qr-output"},T({class:"qr-label"},"Barcode Data"),k({class:"qr-text"},e=>h()||"(no scan yet)")),m({class:"qr-status"},e=>g))});export{F as B};
