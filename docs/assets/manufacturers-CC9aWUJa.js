import"./version-eUJUTvkd.js";import{t as C,S as k,J as F,F as U,D as I,E as T,j as i,I as S,v as m,q as f,K as r,L as E,T as L,M as O,N as R,R as b,O as N,P as z,Q as P,U as j}from"./toast-DbHE0DvQ.js";let g=document.getElementById("manufacturersApp");const s={current:g},t=S.map(e=>e);let d="",o=null,c=!1,p=!1,h=null;const A=()=>{s.current&&(s.current.replaceChildren(),b(w,s.current))},q=()=>{const e=d.trim();e&&(t.push(e),d="",A())},x=e=>{t.splice(e,1),A()},B=async()=>{if(!c){r.error("Sign in to save changes.");return}try{await j(t.map(e=>e)),r.success("Manufacturers saved.")}catch(e){console.error("Failed to save manufacturers",e),r.error("Save failed. Try again.")}},M=()=>F().catch(e=>{console.error("Firebase sign-out failed",e),r.error("Sign out failed. Try again.")}),w=C(()=>[k(M,h),U.class`panel manufacturers-panel`(I("Manage Manufacturers"),T("Update the list used by the swatch editor and add new entries."),i.class`manufacturer-list`(...t.map((e,a)=>i.class`manufacturer-row`(m({class:"manufacturer-input",type:"text",value:()=>t[a]??"",onInput:u=>{t[a]=u.target.value}}),f({type:"button",class:"ghost-button",onClick:()=>x(a)},"Remove")))),i.class`manufacturer-add`(m({class:"manufacturer-input",type:"text",placeholder:"New manufacturer",value:()=>d,onInput:e=>{d=e.target.value}}),f({type:"button",class:"add-button",onClick:q},"âž• Add manufacturer")),i.class`auth-actions`(f({type:"button",class:"add-button",onClick:B},"ðŸ’¾ Save to Firestore")))]),y=()=>{if(!s.current||p)return;const e=P(s);e&&(e.replaceChildren(),b(w,e),p=!0,g=s.current)},l=(e,a,u="")=>{s.current&&(E({rootRef:s,status:e,userEmail:a,adminEmail:"",onSignIn:()=>L().catch(n=>{console.error("Firebase sign-in failed",n),r.error("Sign in failed. Try again.")}),onSignOut:M,setAppMounted:n=>{p=n}}),g=s.current)};l("loading","","initial");const v=async(e,a="")=>{if(c=!1,!e){h=null,o&&(o(),o=null),l("login","","auth:logged-out");return}h={email:e.email||"",photoURL:e.photoURL||""};let u=!1;try{u=await N(e.email||"")}catch(n){console.error("Failed to load admin list",n),r.error("Unable to verify access. Check Firestore rules."),l("denied",e.email||"","auth:permissions");return}if(!u){o&&(o(),o=null),r.error(`Signed in as ${e.email||"unknown"} but not authorized.`),l("denied",e.email||"","auth:denied");return}c=!0,o||(o=z(n=>{Array.isArray(n)&&n.length?t.splice(0,t.length,...n):t.splice(0,t.length,...S),c&&y()})),y()},D=async()=>{O().then(({redirectError:e,redirectResult:a,persistence:u})=>{e&&r.error("Sign-in failed after redirect. Try again."),u.error&&r.error("Safari blocked login storage. Check cookie settings."),a!=null&&a.user&&v(a.user,"redirectResult")}).catch(e=>{console.error("Failed to prepare auth",e),r.error("Sign-in setup failed. Try again.")}),R(e=>{v(e,"onAuthChanged")})};D();
