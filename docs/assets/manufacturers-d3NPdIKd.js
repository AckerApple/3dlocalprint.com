import"./version-DMOBxaS1.js";import{t as C,S as E,J as F,F as L,D as I,E as T,j as c,I as w,v as m,q as f,K as r,L as o,M as k,V as U,N as O,O as N,P as z,U as b,Q as D,R as P,T as R,W as j}from"./debug-DypIrOaF.js";let h=document.getElementById("manufacturersApp");const s={current:h},t=w.map(e=>e);let p="",i=null,l=!1,g=!1;const S=()=>{s.current&&(s.current.replaceChildren(),b(M,s.current))},q=()=>{const e=p.trim();e&&(t.push(e),p="",S())},x=e=>{t.splice(e,1),S()},B=async()=>{if(!l){r.error("Sign in to save changes.");return}try{await j(t.map(e=>e)),r.success("Manufacturers saved.")}catch(e){console.error("Failed to save manufacturers",e),r.error("Save failed. Try again.")}},A=()=>F().catch(e=>{console.error("Firebase sign-out failed",e),r.error("Sign out failed. Try again.")}),M=C(()=>[E(A),L.class`panel manufacturers-panel`(I("Manage Manufacturers"),T("Update the list used by the swatch editor and add new entries."),c.class`manufacturer-list`(...t.map((e,a)=>c.class`manufacturer-row`(m({class:"manufacturer-input",type:"text",value:()=>t[a]??"",onInput:u=>{t[a]=u.target.value}}),f({type:"button",class:"ghost-button",onClick:()=>x(a)},"Remove")))),c.class`manufacturer-add`(m({class:"manufacturer-input",type:"text",placeholder:"New manufacturer",value:()=>p,onInput:e=>{p=e.target.value}}),f({type:"button",class:"add-button",onClick:q},"âž• Add manufacturer")),c.class`auth-actions`(f({type:"button",class:"add-button",onClick:B},"ðŸ’¾ Save to Firestore")))]),v=()=>{if(o("mountApp",{reason:"manufacturers"}),!s.current||g)return;const e=R(s);e&&(e.replaceChildren(),b(M,e),g=!0,h=s.current)},d=(e,a,u="")=>{o("mountSso",{status:e,userEmail:a,reason:u}),s.current&&(k({rootRef:s,status:e,userEmail:a,adminEmail:"",onSignIn:()=>U().catch(n=>{console.error("Firebase sign-in failed",n),r.error("Sign in failed. Try again.")}),onSignOut:A,setAppMounted:n=>{g=n}}),h=s.current)};d("loading","","initial");const y=async(e,a="")=>{if(o("auth:changed",{userEmail:(e==null?void 0:e.email)||null,reason:a}),l=!1,!e){i&&(i(),i=null),d("login","","auth:logged-out");return}let u=!1;try{u=await D(e.email||"")}catch(n){console.error("Failed to load admin list",n),r.error("Unable to verify access. Check Firestore rules."),d("denied",e.email||"","auth:permissions");return}if(!u){i&&(i(),i=null),r.error(`Signed in as ${e.email||"unknown"} but not authorized.`),d("denied",e.email||"","auth:denied");return}l=!0,i||(i=P(n=>{Array.isArray(n)&&n.length?t.splice(0,t.length,...n):t.splice(0,t.length,...w),l&&v()})),v()},J=async()=>{O(),o("page:load",{path:window.location.pathname}),window.addEventListener("pageshow",e=>{o("page:pageshow",{persisted:e.persisted})}),window.addEventListener("pagehide",e=>{o("page:pagehide",{persisted:e.persisted})}),window.addEventListener("visibilitychange",()=>{o("page:visibility",{state:document.visibilityState})}),N().then(({redirectError:e,redirectResult:a})=>{e&&r.error("Sign-in failed after redirect. Try again."),a!=null&&a.user&&y(a.user,"redirectResult")}).catch(e=>{console.error("Failed to prepare auth",e),r.error("Sign-in setup failed. Try again.")}),z(e=>{y(e,"onAuthChanged")})};J();
