import"./version-JERxWKPc.js";import{V as le,F as ve,G as _e,H as we,I as Se,J as be,K as Ee,L as Ce,M as $e,t as x,o as J,N as Re,O as ce,d as g,s as Te,P as Oe,Q as ke,R as De,k as Me,c as R,f as te,l as C,i as k,a as W,b as I,w as Ie,j as qe,g as Pe,p as Le,S as Fe,x as Ae,y as L,z as Be,A as xe,B as Ue,T as He,U as We,C as Ve,D as Qe,W as je}from"./auth-handler-CUxa3Sdo.js";import{A as Ne}from"./AdminNav.tag-BwAcyMET.js";import{n as de,e as ze}from"./barcode-utils-VHKBp8aY.js";import{B as Ge}from"./BarcodeScanner.tag-DHJjCGfw.js";import{f as Je}from"./filter-utils-CsgsWdIu.js";import{w as Ke}from"./adminNavItems-DuM74EKO.js";function Xe(n,e,t,a,s){const r={tagJsType:le.subscribe,states:[],Observables:[n]};ve(r,e,t,a,s)}function ae(n){let e=n;const t=new Set,a=s=>{t.forEach(r=>r(s))};return{component:!1,tagJsType:le.signal,hasValueChanged:be,processInitAttribute:Se,processInit:Xe,processUpdate:we,get value(){return e},set value(s){e!==s&&(e=s,a(s))},destroy:_e,emit:a,subscribe(s){s(e),t.add(s);const r=()=>t.delete(s);return r.unsubscribe=r,r}}}function Ye(n=[]){return Ee()?Ce(()=>ne(ae(n))):ne(ae(n))}function ne(n){const e=["push","pop","splice","shift","unshift"],t=["map","reduce","forEach","every"],a=r=>s[r]=(...i)=>{const o=n.value[r](...i);return n.emit(n.value),o},s=new Proxy(n,{get(r,i){return isNaN(i)?i==="length"?n.value.length:e.includes(i)?a(i):t.includes(i)?n.value[i].bind(n.value):n[i]:n.value[i]},set(r,i,o){return isNaN(i)?i==="length"?(n.value.length=o,n.emit(n.value),!0):(n[i]=o,!0):(n.value[i]=o,n.emit(n.value),!0)}});return s}const se=["PETG","PLA","TPU"],Ze=/\d+/g,et=n=>{if(!n)return"";const e=n.split("#").filter(Boolean),t=n.match(Ze)||[],a=[...e,...t].filter(s=>s);return a.length?a.reduce((s,r)=>r.length>s.length?r:s,""):""},tt="modulepreload",at=function(n,e){return new URL(n,e).href},re={},nt=function(e,t,a){let s=Promise.resolve();if(t&&t.length>0){let i=function(f){return Promise.all(f.map(v=>Promise.resolve(v).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};const o=document.getElementsByTagName("link"),m=document.querySelector("meta[property=csp-nonce]"),h=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));s=i(t.map(f=>{if(f=at(f,a),f in re)return;re[f]=!0;const v=f.endsWith(".css"),l=v?'[rel="stylesheet"]':"";if(!!a)for(let _=o.length-1;_>=0;_--){const b=o[_];if(b.href===f&&(!v||b.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${l}`))return;const c=document.createElement("link");if(c.rel=v?"stylesheet":tt,v||(c.as="script"),c.crossOrigin="",c.href=f,h&&c.setAttribute("nonce",h),document.head.appendChild(c),v)return new Promise((_,b)=>{c.addEventListener("load",_),c.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${f}`)))})}))}function r(i){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i}return s.then(i=>{for(const o of i||[])o.status==="rejected"&&r(o.reason);return e().catch(r)})};class d{constructor(e,t,a,s,r){this._legacyCanvasSize=d.DEFAULT_CANVAS_SIZE,this._preferredCamera="environment",this._maxScansPerSecond=25,this._lastScanTimestamp=-1,this._destroyed=this._flashOn=this._paused=this._active=!1,this.$video=e,this.$canvas=document.createElement("canvas"),a&&typeof a=="object"?this._onDecode=t:(console.warn(a||s||r?"You're using a deprecated version of the QrScanner constructor which will be removed in the future":"Note that the type of the scan result passed to onDecode will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),this._legacyOnDecode=t),t=typeof a=="object"?a:{},this._onDecodeError=t.onDecodeError||(typeof a=="function"?a:this._onDecodeError),this._calculateScanRegion=t.calculateScanRegion||(typeof s=="function"?s:this._calculateScanRegion),this._preferredCamera=t.preferredCamera||r||this._preferredCamera,this._legacyCanvasSize=typeof a=="number"?a:typeof s=="number"?s:this._legacyCanvasSize,this._maxScansPerSecond=t.maxScansPerSecond||this._maxScansPerSecond,this._onPlay=this._onPlay.bind(this),this._onLoadedMetaData=this._onLoadedMetaData.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),this._updateOverlay=this._updateOverlay.bind(this),e.disablePictureInPicture=!0,e.playsInline=!0,e.muted=!0;let i=!1;if(e.hidden&&(e.hidden=!1,i=!0),document.body.contains(e)||(document.body.appendChild(e),i=!0),a=e.parentElement,t.highlightScanRegion||t.highlightCodeOutline){if(s=!!t.overlay,this.$overlay=t.overlay||document.createElement("div"),r=this.$overlay.style,r.position="absolute",r.display="none",r.pointerEvents="none",this.$overlay.classList.add("scan-region-highlight"),!s&&t.highlightScanRegion){this.$overlay.innerHTML='<svg class="scan-region-highlight-svg" viewBox="0 0 238 238" preserveAspectRatio="none" style="position:absolute;width:100%;height:100%;left:0;top:0;fill:none;stroke:#e9b213;stroke-width:4;stroke-linecap:round;stroke-linejoin:round"><path d="M31 2H10a8 8 0 0 0-8 8v21M207 2h21a8 8 0 0 1 8 8v21m0 176v21a8 8 0 0 1-8 8h-21m-176 0H10a8 8 0 0 1-8-8v-21"/></svg>';try{this.$overlay.firstElementChild.animate({transform:["scale(.98)","scale(1.01)"]},{duration:400,iterations:1/0,direction:"alternate",easing:"ease-in-out"})}catch{}a.insertBefore(this.$overlay,this.$video.nextSibling)}t.highlightCodeOutline&&(this.$overlay.insertAdjacentHTML("beforeend",'<svg class="code-outline-highlight" preserveAspectRatio="none" style="display:none;width:100%;height:100%;fill:none;stroke:#e9b213;stroke-width:5;stroke-dasharray:25;stroke-linecap:round;stroke-linejoin:round"><polygon/></svg>'),this.$codeOutlineHighlight=this.$overlay.lastElementChild)}this._scanRegion=this._calculateScanRegion(e),requestAnimationFrame(()=>{let o=window.getComputedStyle(e);o.display==="none"&&(e.style.setProperty("display","block","important"),i=!0),o.visibility!=="visible"&&(e.style.setProperty("visibility","visible","important"),i=!0),i&&(console.warn("QrScanner has overwritten the video hiding style to avoid Safari stopping the playback."),e.style.opacity="0",e.style.width="0",e.style.height="0",this.$overlay&&this.$overlay.parentElement&&this.$overlay.parentElement.removeChild(this.$overlay),delete this.$overlay,delete this.$codeOutlineHighlight),this.$overlay&&this._updateOverlay()}),e.addEventListener("play",this._onPlay),e.addEventListener("loadedmetadata",this._onLoadedMetaData),document.addEventListener("visibilitychange",this._onVisibilityChange),window.addEventListener("resize",this._updateOverlay),this._qrEnginePromise=d.createQrEngine()}static set WORKER_PATH(e){console.warn("Setting QrScanner.WORKER_PATH is not required and not supported anymore. Have a look at the README for new setup instructions.")}static async hasCamera(){try{return!!(await d.listCameras(!1)).length}catch{return!1}}static async listCameras(e=!1){if(!navigator.mediaDevices)return[];let t=async()=>(await navigator.mediaDevices.enumerateDevices()).filter(s=>s.kind==="videoinput"),a;try{e&&(await t()).every(s=>!s.label)&&(a=await navigator.mediaDevices.getUserMedia({audio:!1,video:!0}))}catch{}try{return(await t()).map((s,r)=>({id:s.deviceId,label:s.label||(r===0?"Default Camera":`Camera ${r+1}`)}))}finally{a&&(console.warn("Call listCameras after successfully starting a QR scanner to avoid creating a temporary video stream"),d._stopVideoStream(a))}}async hasFlash(){let e;try{if(this.$video.srcObject){if(!(this.$video.srcObject instanceof MediaStream))return!1;e=this.$video.srcObject}else e=(await this._getCameraStream()).stream;return"torch"in e.getVideoTracks()[0].getSettings()}catch{return!1}finally{e&&e!==this.$video.srcObject&&(console.warn("Call hasFlash after successfully starting the scanner to avoid creating a temporary video stream"),d._stopVideoStream(e))}}isFlashOn(){return this._flashOn}async toggleFlash(){this._flashOn?await this.turnFlashOff():await this.turnFlashOn()}async turnFlashOn(){if(!this._flashOn&&!this._destroyed&&(this._flashOn=!0,this._active&&!this._paused))try{if(!await this.hasFlash())throw"No flash available";await this.$video.srcObject.getVideoTracks()[0].applyConstraints({advanced:[{torch:!0}]})}catch(e){throw this._flashOn=!1,e}}async turnFlashOff(){this._flashOn&&(this._flashOn=!1,await this._restartVideoStream())}destroy(){this.$video.removeEventListener("loadedmetadata",this._onLoadedMetaData),this.$video.removeEventListener("play",this._onPlay),document.removeEventListener("visibilitychange",this._onVisibilityChange),window.removeEventListener("resize",this._updateOverlay),this._destroyed=!0,this._flashOn=!1,this.stop(),d._postWorkerMessage(this._qrEnginePromise,"close")}async start(){if(this._destroyed)throw Error("The QR scanner can not be started as it had been destroyed.");if((!this._active||this._paused)&&(window.location.protocol!=="https:"&&console.warn("The camera stream is only accessible if the page is transferred via https."),this._active=!0,!document.hidden))if(this._paused=!1,this.$video.srcObject)await this.$video.play();else try{let{stream:e,facingMode:t}=await this._getCameraStream();!this._active||this._paused?d._stopVideoStream(e):(this._setVideoMirror(t),this.$video.srcObject=e,await this.$video.play(),this._flashOn&&(this._flashOn=!1,this.turnFlashOn().catch(()=>{})))}catch(e){if(!this._paused)throw this._active=!1,e}}stop(){this.pause(),this._active=!1}async pause(e=!1){if(this._paused=!0,!this._active)return!0;this.$video.pause(),this.$overlay&&(this.$overlay.style.display="none");let t=()=>{this.$video.srcObject instanceof MediaStream&&(d._stopVideoStream(this.$video.srcObject),this.$video.srcObject=null)};return e?(t(),!0):(await new Promise(a=>setTimeout(a,300)),this._paused?(t(),!0):!1)}async setCamera(e){e!==this._preferredCamera&&(this._preferredCamera=e,await this._restartVideoStream())}static async scanImage(e,t,a,s,r=!1,i=!1){let o,m=!1;t&&("scanRegion"in t||"qrEngine"in t||"canvas"in t||"disallowCanvasResizing"in t||"alsoTryWithoutScanRegion"in t||"returnDetailedScanResult"in t)?(o=t.scanRegion,a=t.qrEngine,s=t.canvas,r=t.disallowCanvasResizing||!1,i=t.alsoTryWithoutScanRegion||!1,m=!0):console.warn(t||a||s||r||i?"You're using a deprecated api for scanImage which will be removed in the future.":"Note that the return type of scanImage will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),t=!!a;try{let h,f;[a,h]=await Promise.all([a||d.createQrEngine(),d._loadImage(e)]),[s,f]=d._drawToCanvas(h,o,s,r);let v;if(a instanceof Worker){let l=a;t||d._postWorkerMessageSync(l,"inversionMode","both"),v=await new Promise((y,c)=>{let _,b,T,S=-1;b=O=>{O.data.id===S&&(l.removeEventListener("message",b),l.removeEventListener("error",T),clearTimeout(_),O.data.data!==null?y({data:O.data.data,cornerPoints:d._convertPoints(O.data.cornerPoints,o)}):c(d.NO_QR_CODE_FOUND))},T=O=>{l.removeEventListener("message",b),l.removeEventListener("error",T),clearTimeout(_),c("Scanner error: "+(O?O.message||O:"Unknown Error"))},l.addEventListener("message",b),l.addEventListener("error",T),_=setTimeout(()=>T("timeout"),1e4);let E=f.getImageData(0,0,s.width,s.height);S=d._postWorkerMessageSync(l,"decode",E,[E.data.buffer])})}else v=await Promise.race([new Promise((l,y)=>window.setTimeout(()=>y("Scanner error: timeout"),1e4)),(async()=>{try{var[l]=await a.detect(s);if(!l)throw d.NO_QR_CODE_FOUND;return{data:l.rawValue,cornerPoints:d._convertPoints(l.cornerPoints,o)}}catch(y){if(l=y.message||y,/not implemented|service unavailable/.test(l))return d._disableBarcodeDetector=!0,d.scanImage(e,{scanRegion:o,canvas:s,disallowCanvasResizing:r,alsoTryWithoutScanRegion:i});throw`Scanner error: ${l}`}})()]);return m?v:v.data}catch(h){if(!o||!i)throw h;let f=await d.scanImage(e,{qrEngine:a,canvas:s,disallowCanvasResizing:r});return m?f:f.data}finally{t||d._postWorkerMessage(a,"close")}}setGrayscaleWeights(e,t,a,s=!0){d._postWorkerMessage(this._qrEnginePromise,"grayscaleWeights",{red:e,green:t,blue:a,useIntegerApproximation:s})}setInversionMode(e){d._postWorkerMessage(this._qrEnginePromise,"inversionMode",e)}static async createQrEngine(e){if(e&&console.warn("Specifying a worker path is not required and not supported anymore."),e=()=>nt(()=>import("./qr-scanner-worker.min-D85Z9gVD.js"),[],import.meta.url).then(a=>a.createWorker()),!(!d._disableBarcodeDetector&&"BarcodeDetector"in window&&BarcodeDetector.getSupportedFormats&&(await BarcodeDetector.getSupportedFormats()).includes("qr_code")))return e();let t=navigator.userAgentData;return t&&t.brands.some(({brand:a})=>/Chromium/i.test(a))&&/mac ?OS/i.test(t.platform)&&await t.getHighEntropyValues(["architecture","platformVersion"]).then(({architecture:a,platformVersion:s})=>/arm/i.test(a||"arm")&&13<=parseInt(s||"13")).catch(()=>!0)?e():new BarcodeDetector({formats:["qr_code"]})}_onPlay(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay(),this.$overlay&&(this.$overlay.style.display=""),this._scanFrame()}_onLoadedMetaData(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay()}_onVisibilityChange(){document.hidden?this.pause():this._active&&this.start()}_calculateScanRegion(e){let t=Math.round(.6666666666666666*Math.min(e.videoWidth,e.videoHeight));return{x:Math.round((e.videoWidth-t)/2),y:Math.round((e.videoHeight-t)/2),width:t,height:t,downScaledWidth:this._legacyCanvasSize,downScaledHeight:this._legacyCanvasSize}}_updateOverlay(){requestAnimationFrame(()=>{if(this.$overlay){var e=this.$video,t=e.videoWidth,a=e.videoHeight,s=e.offsetWidth,r=e.offsetHeight,i=e.offsetLeft,o=e.offsetTop,m=window.getComputedStyle(e),h=m.objectFit,f=t/a,v=s/r;switch(h){case"none":var l=t,y=a;break;case"fill":l=s,y=r;break;default:(h==="cover"?f>v:f<v)?(y=r,l=y*f):(l=s,y=l/f),h==="scale-down"&&(l=Math.min(l,t),y=Math.min(y,a))}var[c,_]=m.objectPosition.split(" ").map((T,S)=>{const E=parseFloat(T);return T.endsWith("%")?(S?r-y:s-l)*E/100:E});m=this._scanRegion.width||t,v=this._scanRegion.height||a,h=this._scanRegion.x||0;var b=this._scanRegion.y||0;f=this.$overlay.style,f.width=`${m/t*l}px`,f.height=`${v/a*y}px`,f.top=`${o+_+b/a*y}px`,a=/scaleX\(-1\)/.test(e.style.transform),f.left=`${i+(a?s-c-l:c)+(a?t-h-m:h)/t*l}px`,f.transform=e.style.transform}})}static _convertPoints(e,t){if(!t)return e;let a=t.x||0,s=t.y||0,r=t.width&&t.downScaledWidth?t.width/t.downScaledWidth:1;t=t.height&&t.downScaledHeight?t.height/t.downScaledHeight:1;for(let i of e)i.x=i.x*r+a,i.y=i.y*t+s;return e}_scanFrame(){!this._active||this.$video.paused||this.$video.ended||("requestVideoFrameCallback"in this.$video?this.$video.requestVideoFrameCallback.bind(this.$video):requestAnimationFrame)(async()=>{if(!(1>=this.$video.readyState)){var e=Date.now()-this._lastScanTimestamp,t=1e3/this._maxScansPerSecond;e<t&&await new Promise(s=>setTimeout(s,t-e)),this._lastScanTimestamp=Date.now();try{var a=await d.scanImage(this.$video,{scanRegion:this._scanRegion,qrEngine:this._qrEnginePromise,canvas:this.$canvas})}catch(s){if(!this._active)return;this._onDecodeError(s)}!d._disableBarcodeDetector||await this._qrEnginePromise instanceof Worker||(this._qrEnginePromise=d.createQrEngine()),a?(this._onDecode?this._onDecode(a):this._legacyOnDecode&&this._legacyOnDecode(a.data),this.$codeOutlineHighlight&&(clearTimeout(this._codeOutlineHighlightRemovalTimeout),this._codeOutlineHighlightRemovalTimeout=void 0,this.$codeOutlineHighlight.setAttribute("viewBox",`${this._scanRegion.x||0} ${this._scanRegion.y||0} ${this._scanRegion.width||this.$video.videoWidth} ${this._scanRegion.height||this.$video.videoHeight}`),this.$codeOutlineHighlight.firstElementChild.setAttribute("points",a.cornerPoints.map(({x:s,y:r})=>`${s},${r}`).join(" ")),this.$codeOutlineHighlight.style.display="")):this.$codeOutlineHighlight&&!this._codeOutlineHighlightRemovalTimeout&&(this._codeOutlineHighlightRemovalTimeout=setTimeout(()=>this.$codeOutlineHighlight.style.display="none",100))}this._scanFrame()})}_onDecodeError(e){e!==d.NO_QR_CODE_FOUND&&console.log(e)}async _getCameraStream(){if(!navigator.mediaDevices)throw"Camera not found.";let e=/^(environment|user)$/.test(this._preferredCamera)?"facingMode":"deviceId",t=[{width:{min:1024}},{width:{min:768}},{}],a=t.map(s=>Object.assign({},s,{[e]:{exact:this._preferredCamera}}));for(let s of[...a,...t])try{let r=await navigator.mediaDevices.getUserMedia({video:s,audio:!1}),i=this._getFacingMode(r)||(s.facingMode?this._preferredCamera:this._preferredCamera==="environment"?"user":"environment");return{stream:r,facingMode:i}}catch{}throw"Camera not found."}async _restartVideoStream(){let e=this._paused;await this.pause(!0)&&!e&&this._active&&await this.start()}static _stopVideoStream(e){for(let t of e.getTracks())t.stop(),e.removeTrack(t)}_setVideoMirror(e){this.$video.style.transform="scaleX("+(e==="user"?-1:1)+")"}_getFacingMode(e){return(e=e.getVideoTracks()[0])?/rear|back|environment/i.test(e.label)?"environment":/front|user|face/i.test(e.label)?"user":null:null}static _drawToCanvas(e,t,a,s=!1){a=a||document.createElement("canvas");let r=t&&t.x?t.x:0,i=t&&t.y?t.y:0,o=t&&t.width?t.width:e.videoWidth||e.width,m=t&&t.height?t.height:e.videoHeight||e.height;return s||(s=t&&t.downScaledWidth?t.downScaledWidth:o,t=t&&t.downScaledHeight?t.downScaledHeight:m,a.width!==s&&(a.width=s),a.height!==t&&(a.height=t)),t=a.getContext("2d",{alpha:!1}),t.imageSmoothingEnabled=!1,t.drawImage(e,r,i,o,m,0,0,a.width,a.height),[a,t]}static async _loadImage(e){if(e instanceof Image)return await d._awaitImageLoad(e),e;if(e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof SVGImageElement||"OffscreenCanvas"in window&&e instanceof OffscreenCanvas||"ImageBitmap"in window&&e instanceof ImageBitmap)return e;if(e instanceof File||e instanceof Blob||e instanceof URL||typeof e=="string"){let t=new Image;t.src=e instanceof File||e instanceof Blob?URL.createObjectURL(e):e.toString();try{return await d._awaitImageLoad(t),t}finally{(e instanceof File||e instanceof Blob)&&URL.revokeObjectURL(t.src)}}else throw"Unsupported image type."}static async _awaitImageLoad(e){e.complete&&e.naturalWidth!==0||await new Promise((t,a)=>{let s=r=>{e.removeEventListener("load",s),e.removeEventListener("error",s),r instanceof ErrorEvent?a("Image load error"):t()};e.addEventListener("load",s),e.addEventListener("error",s)})}static async _postWorkerMessage(e,t,a,s){return d._postWorkerMessageSync(await e,t,a,s)}static _postWorkerMessageSync(e,t,a,s){if(!(e instanceof Worker))return-1;let r=d._workerMessageId++;return e.postMessage({id:r,type:t,data:a},s),r}}d.DEFAULT_CANVAS_SIZE=400;d.NO_QR_CODE_FOUND="No QR code found";d._disableBarcodeDetector=!1;d._workerMessageId=0;d.WORKER_PATH=new URL(""+new URL("qr-scanner-worker.min-PJMWJc5V.js",import.meta.url).href,import.meta.url).toString();const st=$e("video"),K=x(({onResult:n})=>{K.inputs(h=>{[{onResult:n}]=h,n=J(n)});let e=null,t="Idle.",a="";const s=`qrPreview-${Math.random().toString(36).slice(2,9)}`,r=h=>{console.log("[qr] status:",h),t=h},i=()=>{e&&(console.log("[qr] stop"),e.stop(),e.destroy(),e=null,r("Camera stopped."))},o=Re(h=>{console.log("[qr] decode result:",h),a=(h==null?void 0:h.data)||"",r("QR detected."),n(a)}),m=async()=>{try{console.log("[qr] start"),r("Requesting camera access...");const h=await new Promise((f,v)=>{let l=0;const y=()=>{const c=document.getElementById(s);if(c)return f(c);if(l+=1,l>30)return v(new Error("QR preview element not found"));requestAnimationFrame(y)};y()});console.log("[qr] preview element:",h),e=new d(h,o,{highlightScanRegion:!0,highlightCodeOutline:!0,preferredCamera:"environment"}),console.log("[qr] scanner created:",e),await e.start(),console.log("[qr] scanner started"),r("Scanning...")}catch(h){console.error("[qr] camera error:",h),r(`Camera error: ${h.message||h}`)}};return x.onDestroy(()=>{i(),console.log("ðŸ”´ stop scanner")}),ce(()=>{m()}),g({class:"qr-panel"},g({class:"qr-preview"},st({id:s,playsInline:!0,muted:!0})),g({class:"qr-output"},Te({class:"qr-label"},"QR Text"),Oe({class:"qr-text"},()=>a||"(no scan yet)")),g({class:"qr-status"},()=>t))}),X=x(({title:n,onClose:e,onApply:t,applyLabel:a,ScannerPanel:s,name:r})=>{X.inputs(c=>{({title:n,onClose:e,onApply:t,applyLabel:a,ScannerPanel:s,name:r}=(c==null?void 0:c[0])||{}),typeof e=="function"?e=J(e):e=()=>{},typeof t=="function"?t=J(t):t=null,typeof s!="function"&&(s=K)}),typeof s!="function"&&(s=K);const i=`${r}-${Math.random().toString(36).slice(2,9)}`,o=()=>{const c=document.getElementById(i);c!=null&&c.close&&c.close()};ke(()=>{o(),e()});let m="";const h=c=>{m=c||"",t&&t(m)},f=()=>{t&&t(m),o()},v=c=>{c.target.nodeName==="DIALOG"&&o()},l=()=>{e()},y=c=>{c!=null&&c.preventDefault&&c.preventDefault(),o()};return ce(()=>{setTimeout(()=>{document.getElementById(i).showModal()},10)}),De.id(i).class`qr-modal`.open(!0).onClick(v).onClose(l).onCancel(y)(g.class`qr-modal-card`(g.class`qr-modal-header`(Me.class`qr-modal-title`(n),g.class`qr-modal-actions`(c=>m&&R.type`button`.class`qr-modal-apply`.onClick(f)(a||"Apply"),R.type`button`.class`qr-modal-close`.attr("aria-label","Close").onClick(()=>o())("Close"))),g.class`qr-modal-body`(c=>s({onResult:h}))))}),ue=x((n={})=>{let{filteredTypes:e=()=>[],groupTypesByManufacturer:t=S=>S,isExpanded:a=()=>!1,toggleExpanded:s=()=>{},removeType:r=()=>{},getBarcodeList:i=()=>[],updateBarcode:o=()=>{},addBarcode:m=()=>{},removeBarcode:h=()=>{},openQrScanner:f=()=>{},openBarcodeScanner:v=()=>{},saveType:l=()=>{},manufacturers:y=[],materialTypes:c=[],withManufacturerEmoji:_=S=>S}=n;ue.updates(S=>{[{filteredTypes:e=()=>[],groupTypesByManufacturer:t=E=>E,isExpanded:a=()=>!1,toggleExpanded:s=()=>{},removeType:r=()=>{},getBarcodeList:i=()=>[],updateBarcode:o=()=>{},addBarcode:m=()=>{},removeBarcode:h=()=>{},openQrScanner:f=()=>{},openBarcodeScanner:v=()=>{},saveType:l=()=>{},manufacturers:y=[],materialTypes:c=[],withManufacturerEmoji:_=E=>E}]=S});const b=e();return t(b).map(([S,E])=>g.class`filament-type-group`(te.class`filament-type-group-title`(S==="Unknown"?"ðŸ­ Unknown":`ðŸ­ ${S}`),O=>E.map((u,Q)=>g({class:"swatch-card",id:`filament-type-card-${u.filament_type_id||Q}`},g.class`filament-type-header`(g.class`summary-chip filament-type-swatch`.style(j=>`background:${u.hex||""};`)(),g(te(j=>u.label||"Untitled filament"),g.class`filament-type-color`(j=>u.color_name||"")),g.class`filament-type-actions`(R.type`button`.class`ghost-button`.onClick(()=>s(u))(a(u)?"Hide":"View"),R.type`button`.class`ghost-button`.onClick(()=>r(Q))("Remove"))),j=>a(u)&&g.class`filament-type-editor`(g.class`fields`(C("Number",k.type`number`.value(p=>u.number??"").onInput(p=>{u.number=p.target.value})()),C("Label",k.value(p=>u.label??"").onInput(p=>{u.label=p.target.value})()),C("ðŸ­ Manufacturer",W.onChange(p=>{var w;u.manufacturer=((w=p==null?void 0:p.target)==null?void 0:w.value)||""})(I.value``.selected(p=>!u.manufacturer)(_("Select manufacturer")),p=>(y||[]).map(w=>I.value(w).selected(N=>u.manufacturer===w)(w).key(w)))),C("Material Type",W.onChange(p=>{var w;u.material_type=((w=p==null?void 0:p.target)==null?void 0:w.value)||""})(I.value``.selected(p=>!u.material_type)("Select material"),p=>c.map(w=>I.value(w).selected(N=>u.material_type===w)(w)))),C("Color name",k.value(p=>u.color_name??"").onInput(p=>{u.color_name=p.target.value})()),C("Hex Color",k.value(p=>u.hex??"").onInput(p=>{u.hex=p.target.value})()),C("Filament code",k.value(p=>u.swatch_code??"").onInput(p=>{u.swatch_code=p.target.value})()),C("QR Search Data",g.class`qr-input-row`(k.class`qr-edit-input`.value(p=>u.qr_search_data??"").onInput(p=>{u.qr_search_data=p.target.value})(),R.type`button`.class`qr-scan-button`.onClick(()=>f(u))("Scan QR"))),C("Bar Codes",g.class`barcode-inputs`(p=>i(u).map((N,z)=>g.class`barcode-entry`(k.class`qr-edit-input`.value(N??"").onInput(ye=>o(u,z,ye.target.value))(),R.type`button`.class`ghost-button barcode-remove`.onClick(()=>h(u,z))("âˆ’")).key(`${u.filament_type_id}-${z}`)),g.class`barcode-actions`(R.type`button`.class`ghost-button`.onClick(()=>m(u))("âž• Add barcode"),R.type`button`.class`qr-scan-button`.onClick(()=>v(u))("Scan barcode")))),C("URL",k.type`url`.value(p=>u.url??"").onInput(p=>{u.url=p.target.value})()),C("Type ID",k.attr("readonly",!0).value(p=>u.filament_type_id||"")())),g.class`edit-card-footer`(R.type`button`.class`add-button`.onClick(()=>l(u))("ðŸ’¾ Save changes")))).key(u.filament_type_id||Q))).key(S))});let ee=document.getElementById("filamentTypesApp");const F={current:ee};let D=Ye(),$=null,M=null,V=[],Y="",Z="",A=null,P=null,B=!1,U=!1,he=null;const q=new Set,ie=typeof window<"u"?new URLSearchParams(window.location.search).get("edit"):"";ie&&q.add(ie);const fe=()=>{var e;if((e=globalThis.crypto)!=null&&e.randomUUID)return crypto.randomUUID();const n=Math.random().toString(36).slice(2,10);return`filament_${Date.now().toString(36)}_${n}`},rt=()=>({filament_type_id:fe(),number:"",label:"",manufacturer:"",material_type:"",color_name:"",swatch_code:"",qr_search_data:"",barcode_search_data:[],hex:"",url:""}),it=()=>{const n=rt();D.unshift(n),n.filament_type_id&&(q.add(n.filament_type_id),n.filament_type_id)},ot=n=>{var a,s;const e=((a=D[n])==null?void 0:a.label)||"this filament type";if(!confirm(`Remove ${e}?`))return;const t=(s=D[n])==null?void 0:s.filament_type_id;t&&q.delete(t),D.splice(n,1)},pe=async()=>{if(!B)return L.error("Sign in to save changes."),!1;try{const n=wt(D.value);return await je(n),L.success("Filament types saved."),!0}catch(n){return console.error("Failed to save filament types",n),L.error("Save failed. Try again."),!1}},lt=async n=>{if(!await pe())return;const t=n==null?void 0:n.filament_type_id;t&&q.delete(t)},me=()=>Ie().catch(n=>{console.error("Firebase sign-out failed",n),L.error("Sign out failed. Try again.")}),H=n=>de(n.barcode_search_data),ct=(n,e,t)=>{const a=H(n);a[e]=(t||"").trim(),n.barcode_search_data=a.filter(Boolean)},dt=n=>{const e=H(n);e.push(""),n.barcode_search_data=e},ut=(n,e)=>{const t=H(n);t.splice(e,1),n.barcode_search_data=t},ht=n=>{A=n},ft=n=>{P=n},pt=n=>{if(!A)return;const e=et(n||"");A.qr_search_data=e||n||"",A=null},mt=n=>{if(!P)return;const t=(ze(n||"")||n||"").trim();if(!t)return;const a=H(P);a.includes(t)||a.push(t),P.barcode_search_data=a,P=null},oe=()=>Je(D.value,{manufacturerFilter:Y,materialTypeFilter:Z}),gt=n=>{const e=new Map;return n.forEach(t=>{const a=t.manufacturer||"Unknown";e.has(a)||e.set(a,[]),e.get(a).push(t)}),Array.from(e.entries()).sort(([t],[a])=>{const s=t==="Unknown",r=a==="Unknown";return s&&!r?-1:!s&&r?1:t.localeCompare(a)})},yt=n=>{const e=n==null?void 0:n.filament_type_id;e&&(q.has(e)?q.delete(e):q.add(e))},vt=n=>n!=null&&n.filament_type_id?q.has(n.filament_type_id):!1,_t=x(()=>(console.log("stopTypes",{stopTypes:$,sub:$.subscribe}),[Ne(me,he),qe.class`panel`(Pe("Filament Types"),Le("Manage filament type details used by inventory."),g.class`meta`(g.class`controls`(g.class`controls-group`(R.type`button`.class`add-button`.onClick(it)("âž• Add filament type"),R.type`button`.class`add-button`.onClick(pe)("ðŸ’¾ Save to Firestore")),g.class`controls-group`(W.value(()=>Y??"").onChange(n=>{var e;Y=((e=n==null?void 0:n.target)==null?void 0:e.value)||""})(I({value:""},"ðŸ­ Filter by manufacturer"),n=>(V||[]).map(e=>I({value:e},e))),W.value(()=>Z??"").onChange(n=>{var e;Z=((e=n==null?void 0:n.target)==null?void 0:e.value)||""})(I({value:""},"Filter by material type"),n=>se.map(e=>I({value:e},e))),g.id`count`(n=>`${oe().length} filament types`)))),g.class`swatch-grid`(Fe(D,()=>ue({filteredTypes:oe,groupTypesByManufacturer:gt,isExpanded:vt,toggleExpanded:yt,removeType:ot,getBarcodeList:H,updateBarcode:ct,addBarcode:dt,removeBarcode:ut,openQrScanner:ht,openBarcodeScanner:ft,saveType:lt,manufacturers:V,materialTypes:se,withManufacturerEmoji:Ke}))),n=>A&&X({name:"qr-scanner-",title:"Scan QR",onClose:()=>{A=null},onApply:pt,applyLabel:"Apply QR"}),n=>P&&X({name:"bc-scanner-",title:"Scan barcode",onClose:()=>{P=null},onApply:mt,applyLabel:"Apply barcode",ScannerPanel:Ge}))])),wt=n=>(Array.isArray(n)?n:[]).map(e=>{const t={filament_type_id:e.filament_type_id||fe(),number:e.number&&Number(e.number)||0,label:e.label||""};e.manufacturer&&(t.manufacturer=e.manufacturer),e.material_type&&(t.material_type=e.material_type),e.color_name&&(t.color_name=e.color_name),e.swatch_code&&(t.swatch_code=e.swatch_code),e.qr_search_data&&(t.qr_search_data=e.qr_search_data);const a=de(e.barcode_search_data);return a.length&&(t.barcode_search_data=a),e.hex&&(t.hex=e.hex),e.url&&(t.url=e.url),t}),G=()=>{if(!F.current||U)return;const n=Ve(F);n&&(n.replaceChildren(),Qe(_t,n),U=!0,ee=F.current)},ge=(n,e,t="")=>{F.current&&(Be({rootRef:F,status:n,userEmail:e,adminEmail:"",onSignIn:()=>xe().catch(a=>{console.error("Firebase sign-in failed",a),L.error("Sign in failed. Try again.")}),onSignOut:me,setAppMounted:a=>{U=a}}),ee=F.current)};ge("loading","","initial");const St=async(n,e="")=>{B=!1,await Ue({user:n,mountSso:ge,toast:L,setCurrentUser:a=>{he=a},onSignedOut:()=>{$&&($(),$=null),M&&(M(),M=null)},onDenied:()=>{$&&($(),$=null),M&&(M(),M=null)},onAuthorized:()=>{B=!0,$||($=He(a=>{console.log("items ++++++",{items:a}),D.length=0,Array.isArray(a)&&D.push(...a.map(s=>({...s}))),!U&&B&&G()}),console.log("stopTypes ready ---",{stopTypes:$})),M||(M=We(a=>{if(Array.isArray(a)&&a.length?V=a:V=[],U){console.log("âœ…");return}B&&G()})),G()},reason:e})};Ae({onUser:St,toast:L});
