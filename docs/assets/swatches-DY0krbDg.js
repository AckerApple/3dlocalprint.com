import{i as be,r as Ee,a as $e,b as ke,g as qe,f as Oe,s as Y,p as Le,c as B,d as Z,h as oe,t as R,e as ie,o as ce,j as f,k as D,l as le,m as De,n as de,q as k,u as O,v as M,w as P,x as $,y as j,z as Re,A as Me,B as Te,C as Ae,S as Pe,D as Ie,E as Fe,F as xe,G as Be,H as ee,I as he,J as He,K as We,L as Ve,M as Qe,N as Ue,O as je,P as Ke,Q as Ne,R as ze}from"./ssoMount-CJ6ITNMd.js";/* empty css               */function Ge(a){const e=a.context;return be(a.templater)?Ee(a):$e(a,a,e)}function L(a){if(!a)return ke;const e=qe();if(!e)throw new Error("output must be used in render sync with a parent context");const t=Oe(e);if(!t)throw new Error("output must be used in render sync fashion");if(a.wrapped===!0)return a;const n=(...r)=>{const s=t.ownerSupport;return Je(r,a,s.context)};return n.wrapped=!0,n}function Je(a,e,t){const n=t.state,r=n.newer.states,s=n.older?n.older.states:r,i=n.newest;Y(r,s);const c=e(...a);return Y(s,r),Le.push([()=>{const d=i.context.global;if(d===void 0||d.deleted===!0){++B.locks,i.context.tagJsVar.processUpdate(i.context.value,i.context,i,[]),--B.locks,Z();return}++B.locks,Ge(i),--B.locks,Z()},[]]),c}const Xe=/\d+/g,ue=a=>{if(!a)return"";const e=a.split("#").filter(Boolean),t=a.match(Xe)||[],n=[...e,...t].filter(r=>r);return n.length?n.reduce((r,s)=>s.length>r.length?s:r,""):""},Ye=(a,e)=>{if(!e)return[];const t=e.toLowerCase();return a.filter(n=>[n.qr_search_data,n.swatch_code,n.number,n.label,n.color_name].filter(s=>s!=null).map(s=>s.toString().toLowerCase()).some(s=>s.includes(t)))},Ze=/\d+/g,pe=a=>{if(!a)return"";const e=a.split("#").filter(Boolean),t=a.match(Ze)||[],n=[...e,...t].filter(r=>r);return n.length?n.reduce((r,s)=>s.length>r.length?s:r,""):""},et=(a,e)=>{if(!e)return[];const t=e.toLowerCase();return a.filter(n=>[n.barcode_search_data,n.swatch_code,n.number,n.label,n.color_name].filter(s=>s!=null).map(s=>s.toString().toLowerCase()).some(s=>s.includes(t)))},tt="modulepreload",at=function(a,e){return new URL(a,e).href},te={},nt=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let i=function(p){return Promise.all(p.map(v=>Promise.resolve(v).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};const c=document.getElementsByTagName("link"),d=document.querySelector("meta[property=csp-nonce]"),h=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));r=i(t.map(p=>{if(p=at(p,n),p in te)return;te[p]=!0;const v=p.endsWith(".css"),l=v?'[rel="stylesheet"]':"";if(!!n)for(let o=c.length-1;o>=0;o--){const y=c[o];if(y.href===p&&(!v||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${l}`))return;const _=document.createElement("link");if(_.rel=v?"stylesheet":tt,v||(_.as="script"),_.crossOrigin="",_.href=p,h&&_.setAttribute("nonce",h),document.head.appendChild(_),v)return new Promise((o,y)=>{_.addEventListener("load",o),_.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${p}`)))})}))}function s(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return r.then(i=>{for(const c of i||[])c.status==="rejected"&&s(c.reason);return e().catch(s)})};class m{constructor(e,t,n,r,s){this._legacyCanvasSize=m.DEFAULT_CANVAS_SIZE,this._preferredCamera="environment",this._maxScansPerSecond=25,this._lastScanTimestamp=-1,this._destroyed=this._flashOn=this._paused=this._active=!1,this.$video=e,this.$canvas=document.createElement("canvas"),n&&typeof n=="object"?this._onDecode=t:(console.warn(n||r||s?"You're using a deprecated version of the QrScanner constructor which will be removed in the future":"Note that the type of the scan result passed to onDecode will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),this._legacyOnDecode=t),t=typeof n=="object"?n:{},this._onDecodeError=t.onDecodeError||(typeof n=="function"?n:this._onDecodeError),this._calculateScanRegion=t.calculateScanRegion||(typeof r=="function"?r:this._calculateScanRegion),this._preferredCamera=t.preferredCamera||s||this._preferredCamera,this._legacyCanvasSize=typeof n=="number"?n:typeof r=="number"?r:this._legacyCanvasSize,this._maxScansPerSecond=t.maxScansPerSecond||this._maxScansPerSecond,this._onPlay=this._onPlay.bind(this),this._onLoadedMetaData=this._onLoadedMetaData.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),this._updateOverlay=this._updateOverlay.bind(this),e.disablePictureInPicture=!0,e.playsInline=!0,e.muted=!0;let i=!1;if(e.hidden&&(e.hidden=!1,i=!0),document.body.contains(e)||(document.body.appendChild(e),i=!0),n=e.parentElement,t.highlightScanRegion||t.highlightCodeOutline){if(r=!!t.overlay,this.$overlay=t.overlay||document.createElement("div"),s=this.$overlay.style,s.position="absolute",s.display="none",s.pointerEvents="none",this.$overlay.classList.add("scan-region-highlight"),!r&&t.highlightScanRegion){this.$overlay.innerHTML='<svg class="scan-region-highlight-svg" viewBox="0 0 238 238" preserveAspectRatio="none" style="position:absolute;width:100%;height:100%;left:0;top:0;fill:none;stroke:#e9b213;stroke-width:4;stroke-linecap:round;stroke-linejoin:round"><path d="M31 2H10a8 8 0 0 0-8 8v21M207 2h21a8 8 0 0 1 8 8v21m0 176v21a8 8 0 0 1-8 8h-21m-176 0H10a8 8 0 0 1-8-8v-21"/></svg>';try{this.$overlay.firstElementChild.animate({transform:["scale(.98)","scale(1.01)"]},{duration:400,iterations:1/0,direction:"alternate",easing:"ease-in-out"})}catch{}n.insertBefore(this.$overlay,this.$video.nextSibling)}t.highlightCodeOutline&&(this.$overlay.insertAdjacentHTML("beforeend",'<svg class="code-outline-highlight" preserveAspectRatio="none" style="display:none;width:100%;height:100%;fill:none;stroke:#e9b213;stroke-width:5;stroke-dasharray:25;stroke-linecap:round;stroke-linejoin:round"><polygon/></svg>'),this.$codeOutlineHighlight=this.$overlay.lastElementChild)}this._scanRegion=this._calculateScanRegion(e),requestAnimationFrame(()=>{let c=window.getComputedStyle(e);c.display==="none"&&(e.style.setProperty("display","block","important"),i=!0),c.visibility!=="visible"&&(e.style.setProperty("visibility","visible","important"),i=!0),i&&(console.warn("QrScanner has overwritten the video hiding style to avoid Safari stopping the playback."),e.style.opacity="0",e.style.width="0",e.style.height="0",this.$overlay&&this.$overlay.parentElement&&this.$overlay.parentElement.removeChild(this.$overlay),delete this.$overlay,delete this.$codeOutlineHighlight),this.$overlay&&this._updateOverlay()}),e.addEventListener("play",this._onPlay),e.addEventListener("loadedmetadata",this._onLoadedMetaData),document.addEventListener("visibilitychange",this._onVisibilityChange),window.addEventListener("resize",this._updateOverlay),this._qrEnginePromise=m.createQrEngine()}static set WORKER_PATH(e){console.warn("Setting QrScanner.WORKER_PATH is not required and not supported anymore. Have a look at the README for new setup instructions.")}static async hasCamera(){try{return!!(await m.listCameras(!1)).length}catch{return!1}}static async listCameras(e=!1){if(!navigator.mediaDevices)return[];let t=async()=>(await navigator.mediaDevices.enumerateDevices()).filter(r=>r.kind==="videoinput"),n;try{e&&(await t()).every(r=>!r.label)&&(n=await navigator.mediaDevices.getUserMedia({audio:!1,video:!0}))}catch{}try{return(await t()).map((r,s)=>({id:r.deviceId,label:r.label||(s===0?"Default Camera":`Camera ${s+1}`)}))}finally{n&&(console.warn("Call listCameras after successfully starting a QR scanner to avoid creating a temporary video stream"),m._stopVideoStream(n))}}async hasFlash(){let e;try{if(this.$video.srcObject){if(!(this.$video.srcObject instanceof MediaStream))return!1;e=this.$video.srcObject}else e=(await this._getCameraStream()).stream;return"torch"in e.getVideoTracks()[0].getSettings()}catch{return!1}finally{e&&e!==this.$video.srcObject&&(console.warn("Call hasFlash after successfully starting the scanner to avoid creating a temporary video stream"),m._stopVideoStream(e))}}isFlashOn(){return this._flashOn}async toggleFlash(){this._flashOn?await this.turnFlashOff():await this.turnFlashOn()}async turnFlashOn(){if(!this._flashOn&&!this._destroyed&&(this._flashOn=!0,this._active&&!this._paused))try{if(!await this.hasFlash())throw"No flash available";await this.$video.srcObject.getVideoTracks()[0].applyConstraints({advanced:[{torch:!0}]})}catch(e){throw this._flashOn=!1,e}}async turnFlashOff(){this._flashOn&&(this._flashOn=!1,await this._restartVideoStream())}destroy(){this.$video.removeEventListener("loadedmetadata",this._onLoadedMetaData),this.$video.removeEventListener("play",this._onPlay),document.removeEventListener("visibilitychange",this._onVisibilityChange),window.removeEventListener("resize",this._updateOverlay),this._destroyed=!0,this._flashOn=!1,this.stop(),m._postWorkerMessage(this._qrEnginePromise,"close")}async start(){if(this._destroyed)throw Error("The QR scanner can not be started as it had been destroyed.");if((!this._active||this._paused)&&(window.location.protocol!=="https:"&&console.warn("The camera stream is only accessible if the page is transferred via https."),this._active=!0,!document.hidden))if(this._paused=!1,this.$video.srcObject)await this.$video.play();else try{let{stream:e,facingMode:t}=await this._getCameraStream();!this._active||this._paused?m._stopVideoStream(e):(this._setVideoMirror(t),this.$video.srcObject=e,await this.$video.play(),this._flashOn&&(this._flashOn=!1,this.turnFlashOn().catch(()=>{})))}catch(e){if(!this._paused)throw this._active=!1,e}}stop(){this.pause(),this._active=!1}async pause(e=!1){if(this._paused=!0,!this._active)return!0;this.$video.pause(),this.$overlay&&(this.$overlay.style.display="none");let t=()=>{this.$video.srcObject instanceof MediaStream&&(m._stopVideoStream(this.$video.srcObject),this.$video.srcObject=null)};return e?(t(),!0):(await new Promise(n=>setTimeout(n,300)),this._paused?(t(),!0):!1)}async setCamera(e){e!==this._preferredCamera&&(this._preferredCamera=e,await this._restartVideoStream())}static async scanImage(e,t,n,r,s=!1,i=!1){let c,d=!1;t&&("scanRegion"in t||"qrEngine"in t||"canvas"in t||"disallowCanvasResizing"in t||"alsoTryWithoutScanRegion"in t||"returnDetailedScanResult"in t)?(c=t.scanRegion,n=t.qrEngine,r=t.canvas,s=t.disallowCanvasResizing||!1,i=t.alsoTryWithoutScanRegion||!1,d=!0):console.warn(t||n||r||s||i?"You're using a deprecated api for scanImage which will be removed in the future.":"Note that the return type of scanImage will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),t=!!n;try{let h,p;[n,h]=await Promise.all([n||m.createQrEngine(),m._loadImage(e)]),[r,p]=m._drawToCanvas(h,c,r,s);let v;if(n instanceof Worker){let l=n;t||m._postWorkerMessageSync(l,"inversionMode","both"),v=await new Promise((u,_)=>{let o,y,w,E=-1;y=S=>{S.data.id===E&&(l.removeEventListener("message",y),l.removeEventListener("error",w),clearTimeout(o),S.data.data!==null?u({data:S.data.data,cornerPoints:m._convertPoints(S.data.cornerPoints,c)}):_(m.NO_QR_CODE_FOUND))},w=S=>{l.removeEventListener("message",y),l.removeEventListener("error",w),clearTimeout(o),_("Scanner error: "+(S?S.message||S:"Unknown Error"))},l.addEventListener("message",y),l.addEventListener("error",w),o=setTimeout(()=>w("timeout"),1e4);let q=p.getImageData(0,0,r.width,r.height);E=m._postWorkerMessageSync(l,"decode",q,[q.data.buffer])})}else v=await Promise.race([new Promise((l,u)=>window.setTimeout(()=>u("Scanner error: timeout"),1e4)),(async()=>{try{var[l]=await n.detect(r);if(!l)throw m.NO_QR_CODE_FOUND;return{data:l.rawValue,cornerPoints:m._convertPoints(l.cornerPoints,c)}}catch(u){if(l=u.message||u,/not implemented|service unavailable/.test(l))return m._disableBarcodeDetector=!0,m.scanImage(e,{scanRegion:c,canvas:r,disallowCanvasResizing:s,alsoTryWithoutScanRegion:i});throw`Scanner error: ${l}`}})()]);return d?v:v.data}catch(h){if(!c||!i)throw h;let p=await m.scanImage(e,{qrEngine:n,canvas:r,disallowCanvasResizing:s});return d?p:p.data}finally{t||m._postWorkerMessage(n,"close")}}setGrayscaleWeights(e,t,n,r=!0){m._postWorkerMessage(this._qrEnginePromise,"grayscaleWeights",{red:e,green:t,blue:n,useIntegerApproximation:r})}setInversionMode(e){m._postWorkerMessage(this._qrEnginePromise,"inversionMode",e)}static async createQrEngine(e){if(e&&console.warn("Specifying a worker path is not required and not supported anymore."),e=()=>nt(()=>import("./qr-scanner-worker.min-D85Z9gVD.js"),[],import.meta.url).then(n=>n.createWorker()),!(!m._disableBarcodeDetector&&"BarcodeDetector"in window&&BarcodeDetector.getSupportedFormats&&(await BarcodeDetector.getSupportedFormats()).includes("qr_code")))return e();let t=navigator.userAgentData;return t&&t.brands.some(({brand:n})=>/Chromium/i.test(n))&&/mac ?OS/i.test(t.platform)&&await t.getHighEntropyValues(["architecture","platformVersion"]).then(({architecture:n,platformVersion:r})=>/arm/i.test(n||"arm")&&13<=parseInt(r||"13")).catch(()=>!0)?e():new BarcodeDetector({formats:["qr_code"]})}_onPlay(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay(),this.$overlay&&(this.$overlay.style.display=""),this._scanFrame()}_onLoadedMetaData(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay()}_onVisibilityChange(){document.hidden?this.pause():this._active&&this.start()}_calculateScanRegion(e){let t=Math.round(.6666666666666666*Math.min(e.videoWidth,e.videoHeight));return{x:Math.round((e.videoWidth-t)/2),y:Math.round((e.videoHeight-t)/2),width:t,height:t,downScaledWidth:this._legacyCanvasSize,downScaledHeight:this._legacyCanvasSize}}_updateOverlay(){requestAnimationFrame(()=>{if(this.$overlay){var e=this.$video,t=e.videoWidth,n=e.videoHeight,r=e.offsetWidth,s=e.offsetHeight,i=e.offsetLeft,c=e.offsetTop,d=window.getComputedStyle(e),h=d.objectFit,p=t/n,v=r/s;switch(h){case"none":var l=t,u=n;break;case"fill":l=r,u=s;break;default:(h==="cover"?p>v:p<v)?(u=s,l=u*p):(l=r,u=l/p),h==="scale-down"&&(l=Math.min(l,t),u=Math.min(u,n))}var[_,o]=d.objectPosition.split(" ").map((w,E)=>{const q=parseFloat(w);return w.endsWith("%")?(E?s-u:r-l)*q/100:q});d=this._scanRegion.width||t,v=this._scanRegion.height||n,h=this._scanRegion.x||0;var y=this._scanRegion.y||0;p=this.$overlay.style,p.width=`${d/t*l}px`,p.height=`${v/n*u}px`,p.top=`${c+o+y/n*u}px`,n=/scaleX\(-1\)/.test(e.style.transform),p.left=`${i+(n?r-_-l:_)+(n?t-h-d:h)/t*l}px`,p.transform=e.style.transform}})}static _convertPoints(e,t){if(!t)return e;let n=t.x||0,r=t.y||0,s=t.width&&t.downScaledWidth?t.width/t.downScaledWidth:1;t=t.height&&t.downScaledHeight?t.height/t.downScaledHeight:1;for(let i of e)i.x=i.x*s+n,i.y=i.y*t+r;return e}_scanFrame(){!this._active||this.$video.paused||this.$video.ended||("requestVideoFrameCallback"in this.$video?this.$video.requestVideoFrameCallback.bind(this.$video):requestAnimationFrame)(async()=>{if(!(1>=this.$video.readyState)){var e=Date.now()-this._lastScanTimestamp,t=1e3/this._maxScansPerSecond;e<t&&await new Promise(r=>setTimeout(r,t-e)),this._lastScanTimestamp=Date.now();try{var n=await m.scanImage(this.$video,{scanRegion:this._scanRegion,qrEngine:this._qrEnginePromise,canvas:this.$canvas})}catch(r){if(!this._active)return;this._onDecodeError(r)}!m._disableBarcodeDetector||await this._qrEnginePromise instanceof Worker||(this._qrEnginePromise=m.createQrEngine()),n?(this._onDecode?this._onDecode(n):this._legacyOnDecode&&this._legacyOnDecode(n.data),this.$codeOutlineHighlight&&(clearTimeout(this._codeOutlineHighlightRemovalTimeout),this._codeOutlineHighlightRemovalTimeout=void 0,this.$codeOutlineHighlight.setAttribute("viewBox",`${this._scanRegion.x||0} ${this._scanRegion.y||0} ${this._scanRegion.width||this.$video.videoWidth} ${this._scanRegion.height||this.$video.videoHeight}`),this.$codeOutlineHighlight.firstElementChild.setAttribute("points",n.cornerPoints.map(({x:r,y:s})=>`${r},${s}`).join(" ")),this.$codeOutlineHighlight.style.display="")):this.$codeOutlineHighlight&&!this._codeOutlineHighlightRemovalTimeout&&(this._codeOutlineHighlightRemovalTimeout=setTimeout(()=>this.$codeOutlineHighlight.style.display="none",100))}this._scanFrame()})}_onDecodeError(e){e!==m.NO_QR_CODE_FOUND&&console.log(e)}async _getCameraStream(){if(!navigator.mediaDevices)throw"Camera not found.";let e=/^(environment|user)$/.test(this._preferredCamera)?"facingMode":"deviceId",t=[{width:{min:1024}},{width:{min:768}},{}],n=t.map(r=>Object.assign({},r,{[e]:{exact:this._preferredCamera}}));for(let r of[...n,...t])try{let s=await navigator.mediaDevices.getUserMedia({video:r,audio:!1}),i=this._getFacingMode(s)||(r.facingMode?this._preferredCamera:this._preferredCamera==="environment"?"user":"environment");return{stream:s,facingMode:i}}catch{}throw"Camera not found."}async _restartVideoStream(){let e=this._paused;await this.pause(!0)&&!e&&this._active&&await this.start()}static _stopVideoStream(e){for(let t of e.getTracks())t.stop(),e.removeTrack(t)}_setVideoMirror(e){this.$video.style.transform="scaleX("+(e==="user"?-1:1)+")"}_getFacingMode(e){return(e=e.getVideoTracks()[0])?/rear|back|environment/i.test(e.label)?"environment":/front|user|face/i.test(e.label)?"user":null:null}static _drawToCanvas(e,t,n,r=!1){n=n||document.createElement("canvas");let s=t&&t.x?t.x:0,i=t&&t.y?t.y:0,c=t&&t.width?t.width:e.videoWidth||e.width,d=t&&t.height?t.height:e.videoHeight||e.height;return r||(r=t&&t.downScaledWidth?t.downScaledWidth:c,t=t&&t.downScaledHeight?t.downScaledHeight:d,n.width!==r&&(n.width=r),n.height!==t&&(n.height=t)),t=n.getContext("2d",{alpha:!1}),t.imageSmoothingEnabled=!1,t.drawImage(e,s,i,c,d,0,0,n.width,n.height),[n,t]}static async _loadImage(e){if(e instanceof Image)return await m._awaitImageLoad(e),e;if(e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof SVGImageElement||"OffscreenCanvas"in window&&e instanceof OffscreenCanvas||"ImageBitmap"in window&&e instanceof ImageBitmap)return e;if(e instanceof File||e instanceof Blob||e instanceof URL||typeof e=="string"){let t=new Image;t.src=e instanceof File||e instanceof Blob?URL.createObjectURL(e):e.toString();try{return await m._awaitImageLoad(t),t}finally{(e instanceof File||e instanceof Blob)&&URL.revokeObjectURL(t.src)}}else throw"Unsupported image type."}static async _awaitImageLoad(e){e.complete&&e.naturalWidth!==0||await new Promise((t,n)=>{let r=s=>{e.removeEventListener("load",r),e.removeEventListener("error",r),s instanceof ErrorEvent?n("Image load error"):t()};e.addEventListener("load",r),e.addEventListener("error",r)})}static async _postWorkerMessage(e,t,n,r){return m._postWorkerMessageSync(await e,t,n,r)}static _postWorkerMessageSync(e,t,n,r){if(!(e instanceof Worker))return-1;let s=m._workerMessageId++;return e.postMessage({id:s,type:t,data:n},r),s}}m.DEFAULT_CANVAS_SIZE=400;m.NO_QR_CODE_FOUND="No QR code found";m._disableBarcodeDetector=!1;m._workerMessageId=0;m.WORKER_PATH=new URL(""+new URL("qr-scanner-worker.min-PJMWJc5V.js",import.meta.url).href,import.meta.url).toString();const rt=oe("video"),K=R(({onResult:a})=>{K.updates(h=>{[{onResult:a}]=h,a=L(a)}),a=L(a);let e=null,t="Idle.",n="";const r=`qrPreview-${Math.random().toString(36).slice(2,9)}`,s=h=>{console.log("[qr] status:",h),t=h},i=()=>{e&&(console.log("[qr] stop"),e.stop(),e.destroy(),e=null,s("Camera stopped."))},c=ie(h=>{console.log("[qr] decode result:",h),n=(h==null?void 0:h.data)||"",s("QR detected."),a(n)}),d=async()=>{try{console.log("[qr] start"),s("Requesting camera access...");const h=await new Promise((p,v)=>{let l=0;const u=()=>{const _=document.getElementById(r);if(_)return p(_);if(l+=1,l>30)return v(new Error("QR preview element not found"));requestAnimationFrame(u)};u()});console.log("[qr] preview element:",h),e=new m(h,c,{highlightScanRegion:!0,highlightCodeOutline:!0,preferredCamera:"environment"}),console.log("[qr] scanner created:",e),await e.start(),console.log("[qr] scanner started"),s("Scanning...")}catch(h){console.error("[qr] camera error:",h),s(`Camera error: ${h.message||h}`)}};return R.onDestroy(()=>{i(),console.log("ðŸ”´ stop scanner")}),ce(()=>{d()}),f({class:"qr-panel"},f({class:"qr-preview"},rt({id:r,playsInline:!0,muted:!0})),f({class:"qr-output"},D({class:"qr-label"},"QR Text"),le({class:"qr-text"},()=>n||"(no scan yet)")),f({class:"qr-status"},()=>t))}),F=R(({title:a,onClose:e,onApply:t,applyLabel:n,ScannerPanel:r})=>{F.updates(u=>{[{title:a,onClose:e,onApply:t,applyLabel:n,ScannerPanel:r}]=u,e=L(e),t&&(t=L(t)),typeof r!="function"&&(r=K)}),e=L(e),t&&(t=L(t)),typeof r!="function"&&(r=K);const s=`qr-modal-${Math.random().toString(36).slice(2,9)}`,i=()=>{const u=document.getElementById(s);u!=null&&u.close&&u.close()};let c="";const d=u=>{c=u||"",t(c)},h=()=>{t&&t(c),i()};return De({id:s,class:"qr-modal",open:!0,onClick:u=>{u.target.nodeName==="DIALOG"&&i()},onClose:()=>{e()},onCancel:u=>{u!=null&&u.preventDefault&&u.preventDefault(),i()}},f({class:"qr-modal-card"},f({class:"qr-modal-header"},de({class:"qr-modal-title"},a),f({class:"qr-modal-actions"},u=>c&&k({type:"button",class:"qr-modal-apply",onClick:h},n||"Apply"),k({type:"button",class:"qr-modal-close","aria-label":"Close",onClick:()=>i()},"Close"))),f({class:"qr-modal-body"},u=>r({onResult:d}))))}),st=oe("video"),X=R(({onResult:a})=>{X.updates(o=>{[{onResult:a}]=o,a=L(a)}),a=L(a);let e="Idle.",t="",n="",r=null,s=null,i=null;const c=`barcodePreview-${Math.random().toString(36).slice(2,9)}`,d=o=>{console.log("[barcode] status:",o),e=o},h=(o,y)=>{t=o,n=y||""},p=()=>{i&&(cancelAnimationFrame(i),i=null),s&&(s.getTracks().forEach(o=>o.stop()),s=null),r=null,d("Camera stopped.")},v=ie(o=>{a(o)}),l=async o=>{if(!(!r||!s)){try{if(o.readyState>=HTMLMediaElement.HAVE_ENOUGH_DATA){const y=await r.detect(o);if(y.length>0){const[w]=y,E=w.rawValue||"",q=w.format||"";E&&v(E),h(E||"(no data)",q),d("Barcode detected.")}else d("Scanning...")}}catch(y){d(`Scan error: ${y.message||y}`)}i=requestAnimationFrame(()=>l(o))}},u=async()=>{if(!("BarcodeDetector"in window)){d("BarcodeDetector API is not supported in this browser.");return}try{d("Requesting camera access...");const o=await new Promise((y,w)=>{let E=0;const q=()=>{const S=document.getElementById(c);if(S)return y(S);if(E+=1,E>30)return w(new Error("Barcode preview element not found"));requestAnimationFrame(q)};q()});r=new BarcodeDetector({formats:["code_128","code_39","code_93","ean_13","ean_8","itf","upc_a","upc_e","qr_code"]}),s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}),o.srcObject=s,await o.play(),d("Scanning..."),l(o)}catch(o){console.error("[barcode] camera error:",o),d(`Camera error: ${o.message||o}`),p()}};R.onDestroy(()=>{p(),console.log("ðŸ”´ stop barcode scanner")}),ce(()=>{u()});const _=()=>t?n?`${t}

format: ${n}`:t:"";return f({class:"qr-panel"},f({class:"qr-preview"},st({id:c,playsInline:!0,muted:!0})),f({class:"qr-output"},D({class:"qr-label"},"Barcode Data"),le({class:"qr-text"},()=>_()||"(no scan yet)")),f({class:"qr-status"},()=>e))}),ge=["PETG","PLA","TPU"],A=["Fireguys","Apples"],me=a=>/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(a),I=(a,e,t)=>{a[e]=t},ot=a=>{if(!a)return"";try{return new URL(a).hostname.replace(/^www\./,"")}catch{return a.replace(/^https?:\/\//,"").split("/")[0]}},b=(a,e,{trim:t=!1}={})=>({onChange:n=>I(a,e,t?n.target.value.trim():n.target.value),onKeyup:n=>I(a,e,t?n.target.value.trim():n.target.value)}),H=(a,e)=>({onChange:t=>I(a,e,t.target.value),onKeyup:t=>I(a,e,t.target.value)}),Q=(a,e)=>({onChange:t=>{var n;return I(a,e,((n=t==null?void 0:t.target)==null?void 0:n.value)||"")}}),fe=R((a,e,t,n,r,s)=>{fe.updates(o=>{[a,e,t,n,r,s]=o}),t=L(t);let i=!1,c=!1,d=!1;const h=()=>{d=!0},p=()=>{d=!0},v=()=>{if(!r||!d)return;const o=r(),y=()=>{d=!1,t(e)};if(o&&typeof o.then=="function"){o.then(y);return}y()},l=()=>{s&&s(e)},u=o=>{const y=ue(o||"");a.qr_search_data=y||o||"",i=!1,h(),console.log("ðŸ‘‰ APPLIED",o)},_=o=>{const y=pe(o||"");a.barcode_search_data=y||o||"",c=!1,h(),console.log("ðŸ‘‰ BARCODE APPLIED",o)};return f.class`swatch-card`(o=>i&&F({title:"Scan QR for this spool",onClose:()=>i=!1,onApply:u,applyLabel:"Apply QR"}),o=>c&&F({title:"Scan barcode for this spool",onClose:()=>c=!1,onApply:_,applyLabel:"Apply barcode",ScannerPanel:X}),f.class`edit-card-header`(D.class`edit-card-title`(o=>`Swatch ${a.number||"-"}`),f.class`edit-card-actions`(r?k.type`button`.class`add-button`.disabled(o=>!d).onClick(v)("ðŸ’¾ Save"):null,s?k.type`button`.class`ghost-button`.onClick(l)("ðŸ§¬ Duplicate"):null,k.type`button`.class`edit-card-toggle`.onClick(()=>t(e)).attr("aria-label","Stop editing swatch")("Done"))),O("Number",M.type`number`.value(()=>a.number??"").onChange(H(a,"number").onChange).onKeyup(H(a,"number").onKeyup)()),f.class`fields`.onInput(p).onChange(p).onKeydown(o=>{o.key==="Enter"&&(o.preventDefault(),v())})(O("Hex Color",f.class`hex-input-row`(M.type`color`.value(()=>me(a.hex)?a.hex:"#000000").style`width:56px; min-width:56px; padding:0; height:42px;`.onChange(o=>{h(),I(a,"hex",o.target.value.trim())})(),M.value(()=>a.hex??"").style`flex:1;`.onChange(b(a,"hex",{trim:!0}).onChange).onKeyup(b(a,"hex",{trim:!0}).onKeyup)())),O("Spool Inventory",M.type`number`.value(()=>a.spool_inventory??"").onChange(H(a,"spool_inventory").onChange).onKeyup(H(a,"spool_inventory").onKeyup)()),O("Label",M.value(()=>a.label??"").onChange(b(a,"label").onChange).onKeyup(b(a,"label").onKeyup)()),O("Manufacturer",P.value(()=>a.manufacturer??"").onChange(Q(a,"manufacturer").onChange)($.value``("Select manufacturer"),...(n||[]).map(o=>$.value(o)(o)))),O("Material Type",P.value(()=>a.material_type??"").onChange(Q(a,"material_type").onChange)($.value``("Select material"),...ge.map(o=>$.value(o)(o)))),O("Location",P.value(()=>a.location??"").onChange(Q(a,"location").onChange)($.value``("Select location"),...A.map(o=>$.value(o)(o)))),O("Color name",M.value(()=>a.color_name??"").onChange(b(a,"color_name").onChange).onKeyup(b(a,"color_name").onKeyup)()),O("Swatch code",M.value(()=>a.swatch_code??"").onChange(b(a,"swatch_code").onChange).onKeyup(b(a,"swatch_code").onKeyup)()),O("QR Search Data",f.class`qr-input-row`(M.class`qr-edit-input`.value(()=>a.qr_search_data??"").onChange(b(a,"qr_search_data").onChange).onKeyup(b(a,"qr_search_data").onKeyup)(),k.type`button`.class`qr-scan-button`.onClick(()=>i=!0)("Scan QR"))),O("Bar Code",f.class`qr-input-row`(M.class`qr-edit-input`.value(()=>a.barcode_search_data??"").onChange(b(a,"barcode_search_data").onChange).onKeyup(b(a,"barcode_search_data").onKeyup)(),k.type`button`.class`qr-scan-button`.onClick(()=>c=!0)("Scan barcode"))),O("URL",M.type`url`.value(()=>a.url??"").onChange(b(a,"url").onChange).onKeyup(b(a,"url").onKeyup)())))}),ye=R((a,e,t)=>(ye.updates(n=>{[a,e,t]=n}),t=L(t),f.class`summary-row`(f(()=>a.number||"-"),f.class`summary-swatch`(f.class`summary-chip`.style(()=>`background:${me(a.hex)?a.hex:""};`)(),D.class`summary-swatch-name`(()=>a.color_name||"Unnamed")),f.class`summary-details`(f.class`summary-title-row`(j(()=>a.label||"Untitled"),k.type`button`.class`summary-edit-button`.onClick(()=>{t(e)})({"aria-label":"Edit swatch"},"âœï¸")),()=>{const n=[];if(a.manufacturer?n.push(D.class`summary-meta-item`(`Maker: ${a.manufacturer}`)):n.push(D.class`summary-meta-item`("Maker: N/A")),a.spool_inventory!==void 0&&a.spool_inventory!==""?n.push(D.class`summary-meta-item`(`Spools: ${a.spool_inventory}`)):n.push(D.class`summary-meta-item`("Spools: N/A")),a.url){const r=ot(a.url);n.push(D.class`summary-meta-item`(Re.href(a.url).attr("target","_blank").attr("rel","noopener noreferrer")(r||a.url)))}return n.length?f.class`summary-meta`(...n):""})))),ve=R((a,e,t,n,r,s,i)=>(ve.updates(c=>{[a,e,t,n,r,s,i]=c,n=L(n)}),n=L(n),Me(c=>t===e?fe(a,e,n,r,s,i):ye(a,e,n))));let W=null;const it=a=>{W=W===a?null:a},ae=a=>{W=a},_e=R((a,e)=>{_e.updates(g=>{[a,e]=g});let t=[],n=!1,r=!1;const s=()=>{t.unshift(ht(A[0]||"")),ae(0)},i=()=>gt(t),c=g=>{const C=t[g];if(!C)return;const x={...C,number:0,location:C.location||A[0]||""};t.splice(g+1,0,x),ae(g+1)};let d=!1,h=!1,p="",v="",l="",u="",_="",o="",y="";const w="__unassigned__",E=g=>{p=g||"",v=ue(p),d=!1},q=g=>{l=ut(g),u=pe(l)||l,h=!1,console.log("app barcode apply",g)},S=()=>mt(t,{manufacturerFilter:_,materialTypeFilter:o,locationFilter:y,unassignedLocation:w,qrToken:v,barcodeToken:u}),Se=()=>ft(S(),[...A,"Unassigned"]);return(()=>{if(!ee){console.debug("SwatchApp load skipped: no loader provided");return}n||r||(r=!0,console.debug("SwatchApp loading swatches..."),R.promise=ee().then(g=>{console.debug("SwatchApp load complete",{count:(g==null?void 0:g.length)||0}),t=re(g||[]),n=!0}).catch(g=>{console.error("SwatchApp load failed",g),t=re([]),n=!0}).finally(()=>{r=!1}))})(),[Te(Pe(e),Ie("Swatch Editor"),Fe("Edit swatches in place. Changes are saved directly to Firestore.")),Ae(xe.class`panel`(f.class`meta`(f.class`controls`(f.class`controls-group`(k({id:"addSwatchButton",class:"add-button",type:"button",onClick:s},"âž• Add swatch"),k({id:"qrSearchButton",class:"add-button",type:"button",onClick:()=>d=!0},"ðŸ“· Search by QR read"),k({id:"barcodeSearchButton",class:"add-button",type:"button",onClick:()=>h=!0},"ðŸ”Ž Search by barcode read")),f.class`controls-group`(P({value:()=>_??"",onChange:g=>{var C;return _=((C=g==null?void 0:g.target)==null?void 0:C.value)||""}},$({value:""},"Filter by manufacturer"),...(a||[]).map(g=>$({value:g},g))),P({value:()=>o??"",onChange:g=>{var C;return o=((C=g==null?void 0:g.target)==null?void 0:C.value)||""}},$({value:""},"Filter by material type"),...ge.map(g=>$({value:g},g))),P({value:()=>y??"",onChange:g=>{var C;return y=((C=g==null?void 0:g.target)==null?void 0:C.value)||""}},$({value:""},"Filter by location"),...A.map(g=>$({value:g},g)),$({value:w},"Unassigned")),f.id`count`(g=>`${S().length} swatches`)))),g=>d&&F({title:"Search by QR read",onClose:()=>{d=!1},onApply:E,applyLabel:"Apply QR"}),g=>h&&F({title:"Search by barcode read",onClose:()=>h=!1,onApply:q,applyLabel:"Apply barcode",ScannerPanel:X}),f({class:"qr-search-pill",hidden:()=>!p},D.class`qr-label`("Active QR search"),j.class`qr-value`(()=>p||"(empty)"),k({type:"button",class:"qr-clear-button",onClick:()=>{p="",v=""}},"Clear search")),f({class:"qr-search-pill",hidden:()=>!l},D.class`qr-label`("Active barcode search"),j.class`qr-value`(()=>l||"(empty)"),k({type:"button",class:"qr-clear-button",onClick:()=>{l="",u=""}},"Clear search")),f.id`summaryList`.class`summary-list`(g=>Se().map(([C,x])=>f.class`location-group`(de.class`location-title`(`${C} (${x.length})`),...x.map(({item:V,index:Ce})=>ve(V,Ce,W,it,a,i,c).key(V.number||V)))))))]}),ct=a=>A.includes(a)?a:"",lt=a=>(Array.isArray(a)?a:[]).map(e=>({...e,location:ct(e.location)})).sort((e,t)=>(Number(e.number)||0)-(Number(t.number)||0)),dt=a=>a.map(e=>{const t={number:Number(e.number)||0,label:e.label||""};return e.color_name&&(t.color_name=e.color_name),e.manufacturer&&(t.manufacturer=e.manufacturer),e.material_type&&(t.material_type=e.material_type),e.swatch_code&&(t.swatch_code=e.swatch_code),e.qr_search_data&&(t.qr_search_data=e.qr_search_data),e.barcode_search_data&&(t.barcode_search_data=e.barcode_search_data),e.hex&&(t.hex=e.hex),e.url&&(t.url=e.url),e.location&&(t.location=e.location),e.spool_inventory!==void 0&&e.spool_inventory!==""&&(t.spool_inventory=Number(e.spool_inventory)||0),t}),ht=(a="")=>({number:0,label:"",manufacturer:"",material_type:"",color_name:"",swatch_code:"",qr_search_data:"",barcode_search_data:"",hex:"",url:"",spool_inventory:1,location:a}),ut=a=>a?a.trim():"",ne=(a,e)=>!e||(a||"").toLowerCase()===e.toLowerCase(),pt=(a,e,t)=>e?e===t?!a:(a||"").toLowerCase()===e.toLowerCase():!0,re=a=>{const e=lt(a);return console.debug("Swatches loaded",{count:e.length}),e},gt=a=>Be(dt(a)).catch(e=>{console.error("Failed to save swatches",e),alert("Save failed. Check the console for details.")}),mt=(a,e)=>a.reduce((t,n,r)=>{const s=ne(n.manufacturer,e.manufacturerFilter),i=ne(n.material_type,e.materialTypeFilter),c=pt(n.location,e.locationFilter,e.unassignedLocation),d=!e.qrToken||Ye([n],e.qrToken).length>0,h=!e.barcodeToken||et([n],e.barcodeToken).length>0;return s&&i&&c&&d&&h&&t.push({item:n,index:r}),t},[]),ft=(a,e)=>{const t=new Map;return e.forEach(n=>{t.set(n,[])}),a.forEach(n=>{const r=n.item.location||e[e.length-1];t.has(r)||t.set(r,[]),t.get(r).push(n)}),Array.from(t.entries()).filter(([,n])=>n.length)},N={current:document.getElementById("swatchApp")},yt=Qe[0];let z=he.map(a=>a),T=null,U=!1,G=!1;const we=()=>He().catch(a=>{console.error("Firebase sign-out failed",a),alert("Sign out failed. Check the console for details.")}),vt=R(()=>_e(z,we)),se=(a="")=>{if(!N.current||G)return;console.debug("mountApp",{reason:a});const e=Ne(N);e&&(e.replaceChildren(),ze(vt,e),G=!0)},J=(a,e,t="")=>{console.debug("mountSso",{status:a,userEmail:e,reason:t}),Ve({rootRef:N,status:a,userEmail:e,adminEmail:yt,onSignIn:()=>Ue().catch(n=>{console.error("Firebase sign-in failed",n),alert("Sign in failed. Check the console for details.")}),onSignOut:we,setAppMounted:n=>{G=n}})};J("loading","","initial");We(a=>{if(console.debug("auth changed",{userEmail:(a==null?void 0:a.email)||null}),U=!1,!a){T&&(T(),T=null),J("login","","auth:logged-out");return}if(!je(a)){T&&(T(),T=null),J("denied",a.email||"","auth:denied");return}U=!0,T||(T=Ke(e=>{if(console.debug("manufacturers update",{count:(e==null?void 0:e.length)||0}),Array.isArray(e)&&e.length?z=e:z=he.map(t=>t),U){se("manufacturers:update");return}})),se("auth:authorized")});
