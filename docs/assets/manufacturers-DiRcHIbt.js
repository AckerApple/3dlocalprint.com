import"./version-B-Wts9-O.js";import{t as w,S as C,J as F,F as I,D as T,E as k,j as i,I as v,v as g,q as f,K as n,L as E,T as U,M as O,N,R as A,O as z,P as L,Q as P,U as R}from"./toast-B5X2p0Bv.js";let h=document.getElementById("manufacturersApp");const s={current:h},t=v.map(a=>a);let d="",o=null,c=!1,p=!1;const S=()=>{s.current&&(s.current.replaceChildren(),A(M,s.current))},j=()=>{const a=d.trim();a&&(t.push(a),d="",S())},q=a=>{t.splice(a,1),S()},x=async()=>{if(!c){n.error("Sign in to save changes.");return}try{await R(t.map(a=>a)),n.success("Manufacturers saved.")}catch(a){console.error("Failed to save manufacturers",a),n.error("Save failed. Try again.")}},b=()=>F().catch(a=>{console.error("Firebase sign-out failed",a),n.error("Sign out failed. Try again.")}),M=w(()=>[C(b),I.class`panel manufacturers-panel`(T("Manage Manufacturers"),k("Update the list used by the swatch editor and add new entries."),i.class`manufacturer-list`(...t.map((a,e)=>i.class`manufacturer-row`(g({class:"manufacturer-input",type:"text",value:()=>t[e]??"",onInput:u=>{t[e]=u.target.value}}),f({type:"button",class:"ghost-button",onClick:()=>q(e)},"Remove")))),i.class`manufacturer-add`(g({class:"manufacturer-input",type:"text",placeholder:"New manufacturer",value:()=>d,onInput:a=>{d=a.target.value}}),f({type:"button",class:"add-button",onClick:j},"âž• Add manufacturer")),i.class`auth-actions`(f({type:"button",class:"add-button",onClick:x},"ðŸ’¾ Save to Firestore")))]),m=()=>{if(!s.current||p)return;const a=P(s);a&&(a.replaceChildren(),A(M,a),p=!0,h=s.current)},l=(a,e,u="")=>{s.current&&(E({rootRef:s,status:a,userEmail:e,adminEmail:"",onSignIn:()=>U().catch(r=>{console.error("Firebase sign-in failed",r),n.error("Sign in failed. Try again.")}),onSignOut:b,setAppMounted:r=>{p=r}}),h=s.current)};l("loading","","initial");const y=async(a,e="")=>{if(c=!1,!a){o&&(o(),o=null),l("login","","auth:logged-out");return}let u=!1;try{u=await z(a.email||"")}catch(r){console.error("Failed to load admin list",r),n.error("Unable to verify access. Check Firestore rules."),l("denied",a.email||"","auth:permissions");return}if(!u){o&&(o(),o=null),n.error(`Signed in as ${a.email||"unknown"} but not authorized.`),l("denied",a.email||"","auth:denied");return}c=!0,o||(o=L(r=>{Array.isArray(r)&&r.length?t.splice(0,t.length,...r):t.splice(0,t.length,...v),c&&m()})),m()},B=async()=>{O().then(({redirectError:a,redirectResult:e})=>{a&&n.error("Sign-in failed after redirect. Try again."),e!=null&&e.user&&y(e.user,"redirectResult")}).catch(a=>{console.error("Failed to prepare auth",a),n.error("Sign-in setup failed. Try again.")}),N(a=>{y(a,"onAuthChanged")})};B();
