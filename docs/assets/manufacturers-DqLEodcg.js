import"./version-z0tULQEd.js";import{t as T,S as L,J as I,F as O,D as B,E as N,j as c,I as U,v as S,q as m,K as s,L as n,M as x,W as z,N as D,O as P,P as A,Q as j,V as C,R as q,T as J,U as K,X as Q}from"./debug-DGwD4Wcc.js";let v=document.getElementById("manufacturersApp");const i={current:v},r=U.map(a=>a);let f="",u=null,p=!1,y=!1;const k=()=>{i.current&&(i.current.replaceChildren(),C(F,i.current))},V=()=>{const a=f.trim();a&&(r.push(a),f="",k())},W=a=>{r.splice(a,1),k()},X=async()=>{if(!p){s.error("Sign in to save changes.");return}try{await Q(r.map(a=>a)),s.success("Manufacturers saved.")}catch(a){console.error("Failed to save manufacturers",a),s.error("Save failed. Try again.")}},E=()=>I().catch(a=>{console.error("Firebase sign-out failed",a),s.error("Sign out failed. Try again.")}),F=T(()=>[L(E),O.class`panel manufacturers-panel`(B("Manage Manufacturers"),N("Update the list used by the swatch editor and add new entries."),c.class`manufacturer-list`(...r.map((a,e)=>c.class`manufacturer-row`(S({class:"manufacturer-input",type:"text",value:()=>r[e]??"",onInput:o=>{r[e]=o.target.value}}),m({type:"button",class:"ghost-button",onClick:()=>W(e)},"Remove")))),c.class`manufacturer-add`(S({class:"manufacturer-input",type:"text",placeholder:"New manufacturer",value:()=>f,onInput:a=>{f=a.target.value}}),m({type:"button",class:"add-button",onClick:V},"âž• Add manufacturer")),c.class`auth-actions`(m({type:"button",class:"add-button",onClick:X},"ðŸ’¾ Save to Firestore")))]),M=()=>{if(n("mountApp",{reason:"manufacturers"}),!i.current||y)return;const a=K(i);a&&(a.replaceChildren(),C(F,a),y=!0,v=i.current)},d=(a,e,o="")=>{n("mountSso",{status:a,userEmail:e,reason:o}),i.current&&(x({rootRef:i,status:a,userEmail:e,adminEmail:"",onSignIn:()=>z().catch(t=>{console.error("Firebase sign-in failed",t),s.error("Sign in failed. Try again.")}),onSignOut:E,setAppMounted:t=>{y=t}}),v=i.current)};d("loading","","initial");const l=async(a,e="")=>{if(n("auth:changed",{userEmail:(a==null?void 0:a.email)||null,reason:e}),p=!1,!a){u&&(u(),u=null),d("login","","auth:logged-out");return}let o=!1;try{o=await q(a.email||"")}catch(t){console.error("Failed to load admin list",t),s.error("Unable to verify access. Check Firestore rules."),d("denied",a.email||"","auth:permissions");return}if(!o){u&&(u(),u=null),s.error(`Signed in as ${a.email||"unknown"} but not authorized.`),d("denied",a.email||"","auth:denied");return}p=!0,u||(u=J(t=>{Array.isArray(t)&&t.length?r.splice(0,r.length,...t):r.splice(0,r.length,...U),p&&M()})),M()},$=async()=>{D(),n("page:load",{path:window.location.pathname}),window.addEventListener("pageshow",a=>{n("page:pageshow",{persisted:a.persisted})}),window.addEventListener("pagehide",a=>{n("page:pagehide",{persisted:a.persisted})}),window.addEventListener("visibilitychange",()=>{n("page:visibility",{state:document.visibilityState})}),P().then(({redirectError:a,redirectResult:e,persistence:o})=>{var t;if(a&&s.error("Sign-in failed after redirect. Try again."),n("auth:persistence",o),o.error&&s.error("Safari blocked login storage. Check cookie settings."),n("auth:redirectResult",{hasUser:!!(e!=null&&e.user),email:((t=e==null?void 0:e.user)==null?void 0:t.email)||""}),e!=null&&e.user&&l(e.user,"redirectResult"),!(e!=null&&e.user)){const w=A();if(w)l(w,"currentUser");else{let g=0;const b=()=>{g+=1;const h=A();if(n("auth:retry",{attempt:g,hasUser:!!h}),h){l(h,"currentUser:retry");return}g<8&&window.setTimeout(b,500)};window.setTimeout(b,500)}}}).catch(a=>{console.error("Failed to prepare auth",a),s.error("Sign-in setup failed. Try again.")}),j(a=>{l(a,"onAuthChanged")})};$();
