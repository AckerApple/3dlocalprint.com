import"./version-JERxWKPc.js";import{V as te,F as de,G as he,H as ue,I as fe,J as pe,K as ge,L as me,M as ye,t as A,o as W,N as ve,O as _e,d as g,s as we,P as Se,Q as be,R as Ce,k as Ee,c as b,f as G,l as w,i as C,a as U,b as O,y as D,w as $e,j as Re,g as Oe,p as Te,S as ke,x as De,z as Me,A as Ie,B as Pe,T as qe,U as Le,C as Fe,D as Ae,W as xe}from"./auth-handler-C4naTd7l.js";import{A as Ue}from"./AdminNav.tag-FMpzw857.js";import{n as ae,e as Be}from"./barcode-utils-VHKBp8aY.js";import{B as He}from"./BarcodeScanner.tag-CF72ICAf.js";import{f as We}from"./filter-utils-CsgsWdIu.js";import{w as Ve}from"./adminNavItems-DuM74EKO.js";function Qe(n,e,t,a,s){const i={tagJsType:te.subscribe,states:[],Observables:[n]};de(i,e,t,a,s)}function J(n){let e=n;const t=new Set,a=s=>{t.forEach(i=>i(s))};return{component:!1,tagJsType:te.signal,hasValueChanged:pe,processInitAttribute:fe,processInit:Qe,processUpdate:ue,get value(){return e},set value(s){e!==s&&(e=s,a(s))},destroy:he,emit:a,subscribe(s){s(e),t.add(s);const i=()=>t.delete(s);return i.unsubscribe=i,i}}}function je(n=[]){return ge()?me(()=>K(J(n))):K(J(n))}function K(n){const e=["push","pop","splice","shift","unshift"],t=["map","reduce","forEach","every"],a=i=>s[i]=(...l)=>{const c=n.value[i](...l);return n.emit(n.value),c},s=new Proxy(n,{get(i,l){return isNaN(l)?l==="length"?n.value.length:e.includes(l)?a(l):t.includes(l)?n.value[l].bind(n.value):n[l]:n.value[l]},set(i,l,c){return isNaN(l)?l==="length"?(n.value.length=c,n.emit(n.value),!0):(n[l]=c,!0):(n.value[l]=c,n.emit(n.value),!0)}});return s}const X=["PETG","PLA","TPU"],Ne=/\d+/g,ze=n=>{if(!n)return"";const e=n.split("#").filter(Boolean),t=n.match(Ne)||[],a=[...e,...t].filter(s=>s);return a.length?a.reduce((s,i)=>i.length>s.length?i:s,""):""},Ge="modulepreload",Je=function(n,e){return new URL(n,e).href},Y={},Ke=function(e,t,a){let s=Promise.resolve();if(t&&t.length>0){let l=function(f){return Promise.all(f.map(o=>Promise.resolve(o).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};const c=document.getElementsByTagName("link"),p=document.querySelector("meta[property=csp-nonce]"),u=(p==null?void 0:p.nonce)||(p==null?void 0:p.getAttribute("nonce"));s=l(t.map(f=>{if(f=Je(f,a),f in Y)return;Y[f]=!0;const o=f.endsWith(".css"),d=o?'[rel="stylesheet"]':"";if(!!a)for(let m=c.length-1;m>=0;m--){const v=c[m];if(v.href===f&&(!o||v.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${d}`))return;const r=document.createElement("link");if(r.rel=o?"stylesheet":Ge,o||(r.as="script"),r.crossOrigin="",r.href=f,u&&r.setAttribute("nonce",u),document.head.appendChild(r),o)return new Promise((m,v)=>{r.addEventListener("load",m),r.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${f}`)))})}))}function i(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return s.then(l=>{for(const c of l||[])c.status==="rejected"&&i(c.reason);return e().catch(i)})};class h{constructor(e,t,a,s,i){this._legacyCanvasSize=h.DEFAULT_CANVAS_SIZE,this._preferredCamera="environment",this._maxScansPerSecond=25,this._lastScanTimestamp=-1,this._destroyed=this._flashOn=this._paused=this._active=!1,this.$video=e,this.$canvas=document.createElement("canvas"),a&&typeof a=="object"?this._onDecode=t:(console.warn(a||s||i?"You're using a deprecated version of the QrScanner constructor which will be removed in the future":"Note that the type of the scan result passed to onDecode will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),this._legacyOnDecode=t),t=typeof a=="object"?a:{},this._onDecodeError=t.onDecodeError||(typeof a=="function"?a:this._onDecodeError),this._calculateScanRegion=t.calculateScanRegion||(typeof s=="function"?s:this._calculateScanRegion),this._preferredCamera=t.preferredCamera||i||this._preferredCamera,this._legacyCanvasSize=typeof a=="number"?a:typeof s=="number"?s:this._legacyCanvasSize,this._maxScansPerSecond=t.maxScansPerSecond||this._maxScansPerSecond,this._onPlay=this._onPlay.bind(this),this._onLoadedMetaData=this._onLoadedMetaData.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),this._updateOverlay=this._updateOverlay.bind(this),e.disablePictureInPicture=!0,e.playsInline=!0,e.muted=!0;let l=!1;if(e.hidden&&(e.hidden=!1,l=!0),document.body.contains(e)||(document.body.appendChild(e),l=!0),a=e.parentElement,t.highlightScanRegion||t.highlightCodeOutline){if(s=!!t.overlay,this.$overlay=t.overlay||document.createElement("div"),i=this.$overlay.style,i.position="absolute",i.display="none",i.pointerEvents="none",this.$overlay.classList.add("scan-region-highlight"),!s&&t.highlightScanRegion){this.$overlay.innerHTML='<svg class="scan-region-highlight-svg" viewBox="0 0 238 238" preserveAspectRatio="none" style="position:absolute;width:100%;height:100%;left:0;top:0;fill:none;stroke:#e9b213;stroke-width:4;stroke-linecap:round;stroke-linejoin:round"><path d="M31 2H10a8 8 0 0 0-8 8v21M207 2h21a8 8 0 0 1 8 8v21m0 176v21a8 8 0 0 1-8 8h-21m-176 0H10a8 8 0 0 1-8-8v-21"/></svg>';try{this.$overlay.firstElementChild.animate({transform:["scale(.98)","scale(1.01)"]},{duration:400,iterations:1/0,direction:"alternate",easing:"ease-in-out"})}catch{}a.insertBefore(this.$overlay,this.$video.nextSibling)}t.highlightCodeOutline&&(this.$overlay.insertAdjacentHTML("beforeend",'<svg class="code-outline-highlight" preserveAspectRatio="none" style="display:none;width:100%;height:100%;fill:none;stroke:#e9b213;stroke-width:5;stroke-dasharray:25;stroke-linecap:round;stroke-linejoin:round"><polygon/></svg>'),this.$codeOutlineHighlight=this.$overlay.lastElementChild)}this._scanRegion=this._calculateScanRegion(e),requestAnimationFrame(()=>{let c=window.getComputedStyle(e);c.display==="none"&&(e.style.setProperty("display","block","important"),l=!0),c.visibility!=="visible"&&(e.style.setProperty("visibility","visible","important"),l=!0),l&&(console.warn("QrScanner has overwritten the video hiding style to avoid Safari stopping the playback."),e.style.opacity="0",e.style.width="0",e.style.height="0",this.$overlay&&this.$overlay.parentElement&&this.$overlay.parentElement.removeChild(this.$overlay),delete this.$overlay,delete this.$codeOutlineHighlight),this.$overlay&&this._updateOverlay()}),e.addEventListener("play",this._onPlay),e.addEventListener("loadedmetadata",this._onLoadedMetaData),document.addEventListener("visibilitychange",this._onVisibilityChange),window.addEventListener("resize",this._updateOverlay),this._qrEnginePromise=h.createQrEngine()}static set WORKER_PATH(e){console.warn("Setting QrScanner.WORKER_PATH is not required and not supported anymore. Have a look at the README for new setup instructions.")}static async hasCamera(){try{return!!(await h.listCameras(!1)).length}catch{return!1}}static async listCameras(e=!1){if(!navigator.mediaDevices)return[];let t=async()=>(await navigator.mediaDevices.enumerateDevices()).filter(s=>s.kind==="videoinput"),a;try{e&&(await t()).every(s=>!s.label)&&(a=await navigator.mediaDevices.getUserMedia({audio:!1,video:!0}))}catch{}try{return(await t()).map((s,i)=>({id:s.deviceId,label:s.label||(i===0?"Default Camera":`Camera ${i+1}`)}))}finally{a&&(console.warn("Call listCameras after successfully starting a QR scanner to avoid creating a temporary video stream"),h._stopVideoStream(a))}}async hasFlash(){let e;try{if(this.$video.srcObject){if(!(this.$video.srcObject instanceof MediaStream))return!1;e=this.$video.srcObject}else e=(await this._getCameraStream()).stream;return"torch"in e.getVideoTracks()[0].getSettings()}catch{return!1}finally{e&&e!==this.$video.srcObject&&(console.warn("Call hasFlash after successfully starting the scanner to avoid creating a temporary video stream"),h._stopVideoStream(e))}}isFlashOn(){return this._flashOn}async toggleFlash(){this._flashOn?await this.turnFlashOff():await this.turnFlashOn()}async turnFlashOn(){if(!this._flashOn&&!this._destroyed&&(this._flashOn=!0,this._active&&!this._paused))try{if(!await this.hasFlash())throw"No flash available";await this.$video.srcObject.getVideoTracks()[0].applyConstraints({advanced:[{torch:!0}]})}catch(e){throw this._flashOn=!1,e}}async turnFlashOff(){this._flashOn&&(this._flashOn=!1,await this._restartVideoStream())}destroy(){this.$video.removeEventListener("loadedmetadata",this._onLoadedMetaData),this.$video.removeEventListener("play",this._onPlay),document.removeEventListener("visibilitychange",this._onVisibilityChange),window.removeEventListener("resize",this._updateOverlay),this._destroyed=!0,this._flashOn=!1,this.stop(),h._postWorkerMessage(this._qrEnginePromise,"close")}async start(){if(this._destroyed)throw Error("The QR scanner can not be started as it had been destroyed.");if((!this._active||this._paused)&&(window.location.protocol!=="https:"&&console.warn("The camera stream is only accessible if the page is transferred via https."),this._active=!0,!document.hidden))if(this._paused=!1,this.$video.srcObject)await this.$video.play();else try{let{stream:e,facingMode:t}=await this._getCameraStream();!this._active||this._paused?h._stopVideoStream(e):(this._setVideoMirror(t),this.$video.srcObject=e,await this.$video.play(),this._flashOn&&(this._flashOn=!1,this.turnFlashOn().catch(()=>{})))}catch(e){if(!this._paused)throw this._active=!1,e}}stop(){this.pause(),this._active=!1}async pause(e=!1){if(this._paused=!0,!this._active)return!0;this.$video.pause(),this.$overlay&&(this.$overlay.style.display="none");let t=()=>{this.$video.srcObject instanceof MediaStream&&(h._stopVideoStream(this.$video.srcObject),this.$video.srcObject=null)};return e?(t(),!0):(await new Promise(a=>setTimeout(a,300)),this._paused?(t(),!0):!1)}async setCamera(e){e!==this._preferredCamera&&(this._preferredCamera=e,await this._restartVideoStream())}static async scanImage(e,t,a,s,i=!1,l=!1){let c,p=!1;t&&("scanRegion"in t||"qrEngine"in t||"canvas"in t||"disallowCanvasResizing"in t||"alsoTryWithoutScanRegion"in t||"returnDetailedScanResult"in t)?(c=t.scanRegion,a=t.qrEngine,s=t.canvas,i=t.disallowCanvasResizing||!1,l=t.alsoTryWithoutScanRegion||!1,p=!0):console.warn(t||a||s||i||l?"You're using a deprecated api for scanImage which will be removed in the future.":"Note that the return type of scanImage will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),t=!!a;try{let u,f;[a,u]=await Promise.all([a||h.createQrEngine(),h._loadImage(e)]),[s,f]=h._drawToCanvas(u,c,s,i);let o;if(a instanceof Worker){let d=a;t||h._postWorkerMessageSync(d,"inversionMode","both"),o=await new Promise((y,r)=>{let m,v,_,M=-1;v=$=>{$.data.id===M&&(d.removeEventListener("message",v),d.removeEventListener("error",_),clearTimeout(m),$.data.data!==null?y({data:$.data.data,cornerPoints:h._convertPoints($.data.cornerPoints,c)}):r(h.NO_QR_CODE_FOUND))},_=$=>{d.removeEventListener("message",v),d.removeEventListener("error",_),clearTimeout(m),r("Scanner error: "+($?$.message||$:"Unknown Error"))},d.addEventListener("message",v),d.addEventListener("error",_),m=setTimeout(()=>_("timeout"),1e4);let L=f.getImageData(0,0,s.width,s.height);M=h._postWorkerMessageSync(d,"decode",L,[L.data.buffer])})}else o=await Promise.race([new Promise((d,y)=>window.setTimeout(()=>y("Scanner error: timeout"),1e4)),(async()=>{try{var[d]=await a.detect(s);if(!d)throw h.NO_QR_CODE_FOUND;return{data:d.rawValue,cornerPoints:h._convertPoints(d.cornerPoints,c)}}catch(y){if(d=y.message||y,/not implemented|service unavailable/.test(d))return h._disableBarcodeDetector=!0,h.scanImage(e,{scanRegion:c,canvas:s,disallowCanvasResizing:i,alsoTryWithoutScanRegion:l});throw`Scanner error: ${d}`}})()]);return p?o:o.data}catch(u){if(!c||!l)throw u;let f=await h.scanImage(e,{qrEngine:a,canvas:s,disallowCanvasResizing:i});return p?f:f.data}finally{t||h._postWorkerMessage(a,"close")}}setGrayscaleWeights(e,t,a,s=!0){h._postWorkerMessage(this._qrEnginePromise,"grayscaleWeights",{red:e,green:t,blue:a,useIntegerApproximation:s})}setInversionMode(e){h._postWorkerMessage(this._qrEnginePromise,"inversionMode",e)}static async createQrEngine(e){if(e&&console.warn("Specifying a worker path is not required and not supported anymore."),e=()=>Ke(()=>import("./qr-scanner-worker.min-D85Z9gVD.js"),[],import.meta.url).then(a=>a.createWorker()),!(!h._disableBarcodeDetector&&"BarcodeDetector"in window&&BarcodeDetector.getSupportedFormats&&(await BarcodeDetector.getSupportedFormats()).includes("qr_code")))return e();let t=navigator.userAgentData;return t&&t.brands.some(({brand:a})=>/Chromium/i.test(a))&&/mac ?OS/i.test(t.platform)&&await t.getHighEntropyValues(["architecture","platformVersion"]).then(({architecture:a,platformVersion:s})=>/arm/i.test(a||"arm")&&13<=parseInt(s||"13")).catch(()=>!0)?e():new BarcodeDetector({formats:["qr_code"]})}_onPlay(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay(),this.$overlay&&(this.$overlay.style.display=""),this._scanFrame()}_onLoadedMetaData(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay()}_onVisibilityChange(){document.hidden?this.pause():this._active&&this.start()}_calculateScanRegion(e){let t=Math.round(.6666666666666666*Math.min(e.videoWidth,e.videoHeight));return{x:Math.round((e.videoWidth-t)/2),y:Math.round((e.videoHeight-t)/2),width:t,height:t,downScaledWidth:this._legacyCanvasSize,downScaledHeight:this._legacyCanvasSize}}_updateOverlay(){requestAnimationFrame(()=>{if(this.$overlay){var e=this.$video,t=e.videoWidth,a=e.videoHeight,s=e.offsetWidth,i=e.offsetHeight,l=e.offsetLeft,c=e.offsetTop,p=window.getComputedStyle(e),u=p.objectFit,f=t/a,o=s/i;switch(u){case"none":var d=t,y=a;break;case"fill":d=s,y=i;break;default:(u==="cover"?f>o:f<o)?(y=i,d=y*f):(d=s,y=d/f),u==="scale-down"&&(d=Math.min(d,t),y=Math.min(y,a))}var[r,m]=p.objectPosition.split(" ").map((_,M)=>{const L=parseFloat(_);return _.endsWith("%")?(M?i-y:s-d)*L/100:L});p=this._scanRegion.width||t,o=this._scanRegion.height||a,u=this._scanRegion.x||0;var v=this._scanRegion.y||0;f=this.$overlay.style,f.width=`${p/t*d}px`,f.height=`${o/a*y}px`,f.top=`${c+m+v/a*y}px`,a=/scaleX\(-1\)/.test(e.style.transform),f.left=`${l+(a?s-r-d:r)+(a?t-u-p:u)/t*d}px`,f.transform=e.style.transform}})}static _convertPoints(e,t){if(!t)return e;let a=t.x||0,s=t.y||0,i=t.width&&t.downScaledWidth?t.width/t.downScaledWidth:1;t=t.height&&t.downScaledHeight?t.height/t.downScaledHeight:1;for(let l of e)l.x=l.x*i+a,l.y=l.y*t+s;return e}_scanFrame(){!this._active||this.$video.paused||this.$video.ended||("requestVideoFrameCallback"in this.$video?this.$video.requestVideoFrameCallback.bind(this.$video):requestAnimationFrame)(async()=>{if(!(1>=this.$video.readyState)){var e=Date.now()-this._lastScanTimestamp,t=1e3/this._maxScansPerSecond;e<t&&await new Promise(s=>setTimeout(s,t-e)),this._lastScanTimestamp=Date.now();try{var a=await h.scanImage(this.$video,{scanRegion:this._scanRegion,qrEngine:this._qrEnginePromise,canvas:this.$canvas})}catch(s){if(!this._active)return;this._onDecodeError(s)}!h._disableBarcodeDetector||await this._qrEnginePromise instanceof Worker||(this._qrEnginePromise=h.createQrEngine()),a?(this._onDecode?this._onDecode(a):this._legacyOnDecode&&this._legacyOnDecode(a.data),this.$codeOutlineHighlight&&(clearTimeout(this._codeOutlineHighlightRemovalTimeout),this._codeOutlineHighlightRemovalTimeout=void 0,this.$codeOutlineHighlight.setAttribute("viewBox",`${this._scanRegion.x||0} ${this._scanRegion.y||0} ${this._scanRegion.width||this.$video.videoWidth} ${this._scanRegion.height||this.$video.videoHeight}`),this.$codeOutlineHighlight.firstElementChild.setAttribute("points",a.cornerPoints.map(({x:s,y:i})=>`${s},${i}`).join(" ")),this.$codeOutlineHighlight.style.display="")):this.$codeOutlineHighlight&&!this._codeOutlineHighlightRemovalTimeout&&(this._codeOutlineHighlightRemovalTimeout=setTimeout(()=>this.$codeOutlineHighlight.style.display="none",100))}this._scanFrame()})}_onDecodeError(e){e!==h.NO_QR_CODE_FOUND&&console.log(e)}async _getCameraStream(){if(!navigator.mediaDevices)throw"Camera not found.";let e=/^(environment|user)$/.test(this._preferredCamera)?"facingMode":"deviceId",t=[{width:{min:1024}},{width:{min:768}},{}],a=t.map(s=>Object.assign({},s,{[e]:{exact:this._preferredCamera}}));for(let s of[...a,...t])try{let i=await navigator.mediaDevices.getUserMedia({video:s,audio:!1}),l=this._getFacingMode(i)||(s.facingMode?this._preferredCamera:this._preferredCamera==="environment"?"user":"environment");return{stream:i,facingMode:l}}catch{}throw"Camera not found."}async _restartVideoStream(){let e=this._paused;await this.pause(!0)&&!e&&this._active&&await this.start()}static _stopVideoStream(e){for(let t of e.getTracks())t.stop(),e.removeTrack(t)}_setVideoMirror(e){this.$video.style.transform="scaleX("+(e==="user"?-1:1)+")"}_getFacingMode(e){return(e=e.getVideoTracks()[0])?/rear|back|environment/i.test(e.label)?"environment":/front|user|face/i.test(e.label)?"user":null:null}static _drawToCanvas(e,t,a,s=!1){a=a||document.createElement("canvas");let i=t&&t.x?t.x:0,l=t&&t.y?t.y:0,c=t&&t.width?t.width:e.videoWidth||e.width,p=t&&t.height?t.height:e.videoHeight||e.height;return s||(s=t&&t.downScaledWidth?t.downScaledWidth:c,t=t&&t.downScaledHeight?t.downScaledHeight:p,a.width!==s&&(a.width=s),a.height!==t&&(a.height=t)),t=a.getContext("2d",{alpha:!1}),t.imageSmoothingEnabled=!1,t.drawImage(e,i,l,c,p,0,0,a.width,a.height),[a,t]}static async _loadImage(e){if(e instanceof Image)return await h._awaitImageLoad(e),e;if(e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof SVGImageElement||"OffscreenCanvas"in window&&e instanceof OffscreenCanvas||"ImageBitmap"in window&&e instanceof ImageBitmap)return e;if(e instanceof File||e instanceof Blob||e instanceof URL||typeof e=="string"){let t=new Image;t.src=e instanceof File||e instanceof Blob?URL.createObjectURL(e):e.toString();try{return await h._awaitImageLoad(t),t}finally{(e instanceof File||e instanceof Blob)&&URL.revokeObjectURL(t.src)}}else throw"Unsupported image type."}static async _awaitImageLoad(e){e.complete&&e.naturalWidth!==0||await new Promise((t,a)=>{let s=i=>{e.removeEventListener("load",s),e.removeEventListener("error",s),i instanceof ErrorEvent?a("Image load error"):t()};e.addEventListener("load",s),e.addEventListener("error",s)})}static async _postWorkerMessage(e,t,a,s){return h._postWorkerMessageSync(await e,t,a,s)}static _postWorkerMessageSync(e,t,a,s){if(!(e instanceof Worker))return-1;let i=h._workerMessageId++;return e.postMessage({id:i,type:t,data:a},s),i}}h.DEFAULT_CANVAS_SIZE=400;h.NO_QR_CODE_FOUND="No QR code found";h._disableBarcodeDetector=!1;h._workerMessageId=0;h.WORKER_PATH=new URL(""+new URL("qr-scanner-worker.min-PJMWJc5V.js",import.meta.url).href,import.meta.url).toString();const Xe=ye("video"),V=A(({onResult:n})=>{V.inputs(u=>{[{onResult:n}]=u,n=W(n)});let e=null,t="Idle.",a="";const s=`qrPreview-${Math.random().toString(36).slice(2,9)}`,i=u=>{console.log("[qr] status:",u),t=u},l=()=>{e&&(console.log("[qr] stop"),e.stop(),e.destroy(),e=null,i("Camera stopped."))},c=ve(u=>{console.log("[qr] decode result:",u),a=(u==null?void 0:u.data)||"",i("QR detected."),n(a)}),p=async()=>{try{console.log("[qr] start"),i("Requesting camera access...");const u=await new Promise((f,o)=>{let d=0;const y=()=>{const r=document.getElementById(s);if(r)return f(r);if(d+=1,d>30)return o(new Error("QR preview element not found"));requestAnimationFrame(y)};y()});console.log("[qr] preview element:",u),e=new h(u,c,{highlightScanRegion:!0,highlightCodeOutline:!0,preferredCamera:"environment"}),console.log("[qr] scanner created:",e),await e.start(),console.log("[qr] scanner started"),i("Scanning...")}catch(u){console.error("[qr] camera error:",u),i(`Camera error: ${u.message||u}`)}};return A.onDestroy(()=>{l(),console.log("ðŸ”´ stop scanner")}),_e(()=>{p()}),g({class:"qr-panel"},g({class:"qr-preview"},Xe({id:s,playsInline:!0,muted:!0})),g({class:"qr-output"},we({class:"qr-label"},"QR Text"),Se({class:"qr-text"},()=>a||"(no scan yet)")),g({class:"qr-status"},()=>t))}),Q=A(({title:n,onClose:e,onApply:t,applyLabel:a,ScannerPanel:s,name:i})=>{Q.inputs(r=>{({title:n,onClose:e,onApply:t,applyLabel:a,ScannerPanel:s,name:i}=(r==null?void 0:r[0])||{}),typeof e=="function"?e=W(e):e=()=>{},typeof t=="function"?t=W(t):t=null,typeof s!="function"&&(s=V)}),typeof s!="function"&&(s=V);const l=`${i}-${Math.random().toString(36).slice(2,9)}`,c=()=>{const r=document.getElementById(l);r!=null&&r.close&&r.close()};be(()=>{c(),e()});let p="";const u=r=>{p=r||"",t&&t(p)},f=()=>{t&&t(p),c()},o=r=>{r.target.nodeName==="DIALOG"&&c()},d=()=>{e()},y=r=>{r!=null&&r.preventDefault&&r.preventDefault(),c()};return Ce.id(l).class`qr-modal`.open(!0).onClick(o).onClose(d).onCancel(y)(g.class`qr-modal-card`(g.class`qr-modal-header`(Ee.class`qr-modal-title`(n),g.class`qr-modal-actions`(r=>p&&b.type`button`.class`qr-modal-apply`.onClick(f)(a||"Apply"),b.type`button`.class`qr-modal-close`.attr("aria-label","Close").onClick(()=>c())("Close"))),g.class`qr-modal-body`(r=>s({onResult:u}))))}),Ye=n=>{const e=String(n||"").trim();return/^#[0-9a-fA-F]{6}$/.test(e)?e:/^[0-9a-fA-F]{6}$/.test(e)?`#${e}`:"#000000"},ne=A(({types:n=[],expandedTypeIds:e=new Set,manufacturers:t=[],materialTypes:a=[],withManufacturerEmoji:s=i=>i}={})=>{let i=[];ne.inputs(c=>{[{types:n=[],expandedTypeIds:e,groupTypesByManufacturer:i,manufacturers:t=[],materialTypes:a=[],withManufacturerEmoji:s=p=>p}]=c,i=Ze(n)});const l=c=>c!=null&&c.filament_type_id?e.has(c.filament_type_id):!1;return[c=>i.map(([p,u])=>g.class`filament-type-group`(G.class`filament-type-group-title`(p==="Unknown"?"ðŸ­ Unknown":`ðŸ­ ${p}`),f=>u.map((o,d)=>g({class:"swatch-card",id:`filament-type-card-${o.filament_type_id||d}`},g.class`filament-type-header`(g.class`summary-chip filament-type-swatch`.style(y=>`background:${o.hex||""};`)(),g(G(y=>o.label),g.class`filament-type-color`(y=>o.color_name||"")),g.class`filament-type-actions`(b.type`button`.class`ghost-button`.onClick(()=>dt(o))(l(o)?"Hide":"View"),b.type`button`.class`ghost-button`.onClick(()=>at(d))("Remove"))),y=>l(o)&&g.class`filament-type-editor`(g.class`fields`(w("Number",C.type`number`.value(r=>o.number??"").onInput(r=>{o.number=r.target.value})()),w("Label",C.value(r=>o.label??"").onInput(r=>{o.label=r.target.value})()),w("ðŸ­ Manufacturer",U.onChange(r=>{var m;o.manufacturer=((m=r==null?void 0:r.target)==null?void 0:m.value)||""})(O.value``.selected(r=>!o.manufacturer)(s("Select manufacturer")),r=>(t||[]).map(m=>O.value(m).selected(v=>o.manufacturer===m)(m).key(m)))),w("Material Type",U.onChange(r=>{var m;o.material_type=((m=r==null?void 0:r.target)==null?void 0:m.value)||""})(O.value``.selected(r=>!o.material_type)("Select material"),r=>a.map(m=>O.value(m).selected(v=>o.material_type===m)(m)))),w("Color name",C.value(r=>o.color_name??"").onInput(r=>{o.color_name=r.target.value})()),w("Hex Color",g.class`hex-input-row`(C.value(r=>o.hex??"").onInput(r=>{o.hex=r.target.value})(),C.type`color`.value(r=>Ye(o.hex)).onChange(r=>{o.hex=r.target.value})())),w("Filament code",C.value(r=>o.swatch_code??"").onInput(r=>{o.swatch_code=r.target.value})()),w("QR Search Data",g.class`qr-input-row`(C.class`qr-edit-input`.value(r=>o.qr_search_data??"").onInput(r=>{o.qr_search_data=r.target.value})(),b.type`button`.class`qr-scan-button`.onClick(()=>it(o))("Scan QR"))),w("Bar Codes",g.class`barcode-inputs`(r=>q(o).map((v,_)=>g.class`barcode-entry`(C.class`qr-edit-input`.value(v??"").onInput(M=>st(o,_,M.target.value))(),b.type`button`.class`ghost-button barcode-remove`.onClick(()=>le(o,_))("âˆ’")).key(`${o.filament_type_id}-${_}`)),g.class`barcode-actions`(b.type`button`.class`ghost-button`.onClick(()=>rt(o))("âž• Add barcode"),b.type`button`.class`qr-scan-button`.onClick(()=>ot(o))("Scan barcode")))),w("URL",C.type`url`.value(r=>o.url??"").onInput(r=>{o.url=r.target.value})()),w("Type ID",C.attr("readonly",!0).value(r=>o.filament_type_id||"")())),g.class`edit-card-footer`(b.type`button`.class`add-button`.onClick(()=>nt(o))("ðŸ’¾ Save changes")))).key(o.filament_type_id||d))).key(p))]}),Ze=n=>{const e=new Map;return n.forEach(t=>{const a=t.manufacturer||"Unknown";e.has(a)||e.set(a,[]),e.get(a).push(t)}),Array.from(e.entries()).sort(([t],[a])=>{const s=t==="Unknown",i=a==="Unknown";return s&&!i?-1:!s&&i?1:t.localeCompare(a)})};let z=document.getElementById("filamentTypesApp");const I={current:z};let E=je(),S=null,R=null,B=[],j="",N="",P=null,k=null,F=!1,x=!1,se=null;const T=new Set,Z=typeof window<"u"?new URLSearchParams(window.location.search).get("edit"):"";Z&&T.add(Z);const re=()=>{var e;if((e=globalThis.crypto)!=null&&e.randomUUID)return crypto.randomUUID();const n=Math.random().toString(36).slice(2,10);return`filament_${Date.now().toString(36)}_${n}`},et=()=>({filament_type_id:re(),number:"",label:"",manufacturer:"",material_type:"",color_name:"",swatch_code:"",qr_search_data:"",barcode_search_data:[],hex:"",url:""}),tt=()=>{const n=et();n.filament_type_id&&(T.add(n.filament_type_id),n.filament_type_id),E.unshift(n)},at=n=>{var a,s;const e=((a=E[n])==null?void 0:a.label)||"this filament type";if(!confirm(`Remove ${e}?`))return;const t=(s=E[n])==null?void 0:s.filament_type_id;t&&T.delete(t),E.splice(n,1)},ie=async()=>{if(!F)return D.error("Sign in to save changes."),!1;try{const n=ut(E.value);return await xe(n),D.success("Filament types saved."),!0}catch(n){return console.error("Failed to save filament types",n),D.error("Save failed. Try again."),!1}},nt=async n=>{if(!await ie())return;const t=n==null?void 0:n.filament_type_id;t&&T.delete(t)},oe=()=>$e().catch(n=>{console.error("Firebase sign-out failed",n),D.error("Sign out failed. Try again.")}),q=n=>ae(n.barcode_search_data),st=(n,e,t)=>{const a=q(n);a[e]=(t||"").trim(),n.barcode_search_data=a.filter(Boolean)},rt=n=>{const e=q(n);e.push(""),n.barcode_search_data=e},le=(n,e)=>{const t=q(n);t.splice(e,1),n.barcode_search_data=t},it=n=>{P=n},ot=n=>{k=n},lt=n=>{if(!P)return;const e=ze(n||"");P.qr_search_data=e||n||"",P=null},ct=n=>{if(!k)return;const t=(Be(n||"")||n||"").trim();if(!t)return;const a=q(k);a.includes(t)||a.push(t),k.barcode_search_data=a,k=null},ee=()=>We(E.value,{manufacturerFilter:j,materialTypeFilter:N}),dt=n=>{const e=n==null?void 0:n.filament_type_id;e&&(T.has(e)?T.delete(e):T.add(e))},ht=A(()=>(console.log("stopTypes",{stopTypes:S,sub:S.subscribe}),[Ue(oe,se),Re.class`panel`(Oe("Filament Types"),Te("Manage filament type details used by inventory."),g.class`meta`(g.class`controls`(g.class`controls-group`(b.type`button`.class`add-button`.onClick(tt)("âž• Add filament type"),b.type`button`.class`add-button`.onClick(ie)("ðŸ’¾ Save to Firestore")),g.class`controls-group`(U.value(()=>j??"").onChange(n=>{var e;j=((e=n==null?void 0:n.target)==null?void 0:e.value)||""})(O({value:""},"ðŸ­ Filter by manufacturer"),n=>(B||[]).map(e=>O({value:e},e))),U.value(()=>N??"").onChange(n=>{var e;N=((e=n==null?void 0:n.target)==null?void 0:e.value)||""})(O({value:""},"Filter by material type"),n=>X.map(e=>O({value:e},e))),g.id`count`(n=>`${ee().length} filament types`)))),g.class`swatch-grid`(ke(E,n=>ne({types:n,expandedTypeIds:T,filteredTypes:ee,getBarcodeList:q,removeBarcode:le,manufacturers:B,materialTypes:X,withManufacturerEmoji:Ve}))),n=>P&&Q({name:"qr-scanner-",title:"Scan QR",onClose:()=>{P=null},onApply:lt,applyLabel:"Apply QR"}),n=>k&&Q({name:"bc-scanner-",title:"Scan barcode",onClose:()=>{k=null},onApply:ct,applyLabel:"Apply barcode",ScannerPanel:He}))])),ut=n=>(Array.isArray(n)?n:[]).map(e=>{const t={filament_type_id:e.filament_type_id||re(),number:e.number&&Number(e.number)||0,label:e.label||""};e.manufacturer&&(t.manufacturer=e.manufacturer),e.material_type&&(t.material_type=e.material_type),e.color_name&&(t.color_name=e.color_name),e.swatch_code&&(t.swatch_code=e.swatch_code),e.qr_search_data&&(t.qr_search_data=e.qr_search_data);const a=ae(e.barcode_search_data);return a.length&&(t.barcode_search_data=a),e.hex&&(t.hex=e.hex),e.url&&(t.url=e.url),t}),H=()=>{if(!I.current||x)return;const n=Fe(I);n&&(n.replaceChildren(),Ae(ht,n),x=!0,z=I.current)},ce=(n,e,t="")=>{I.current&&(Me({rootRef:I,status:n,userEmail:e,adminEmail:"",onSignIn:()=>Ie().catch(a=>{console.error("Firebase sign-in failed",a),D.error("Sign in failed. Try again.")}),onSignOut:oe,setAppMounted:a=>{x=a}}),z=I.current)};ce("loading","","initial");const ft=async(n,e="")=>{F=!1,await Pe({user:n,mountSso:ce,toast:D,setCurrentUser:a=>{se=a},onSignedOut:()=>{S&&(S(),S=null),R&&(R(),R=null)},onDenied:()=>{S&&(S(),S=null),R&&(R(),R=null)},onAuthorized:()=>{F=!0,S||(S=qe(a=>{console.log("items ++++++",{items:a}),E.length=0,Array.isArray(a)&&E.push(...a.map(s=>({...s}))),!x&&F&&H()}),console.log("stopTypes ready ---",{stopTypes:S})),R||(R=Le(a=>{if(Array.isArray(a)&&a.length?B=a:B=[],x){console.log("âœ…");return}F&&H()})),H()},reason:e})};De({onUser:ft,toast:D});
