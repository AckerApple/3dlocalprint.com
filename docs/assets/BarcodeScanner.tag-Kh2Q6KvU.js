import{F as S,t as h,G as D,W as I,d as m,s as F,I as E}from"./toast-Dm6QH7Hm.js";import{o as q}from"./barcode-utils-Bh5zqa5o.js";const M=S("video"),T=h(({onResult:r,formats:c})=>{T.updates(e=>{[{onResult:r,formats:c}]=e,r=q(r)}),r=q(r);const v=Array.isArray(c)&&c.length?c:["code_128","code_39","code_93","ean_13","ean_8","itf","upc_a","upc_e","qr_code"];let f="Idle.",i="",p="",l=null,n=null,d=null;const g=`barcodePreview-${Math.random().toString(36).slice(2,9)}`,a=e=>{console.log("[barcode] status:",e),f=e},_=(e,t)=>{i=e,p=t||""},w=()=>{d&&(cancelAnimationFrame(d),d=null),n&&(n.getTracks().forEach(e=>e.stop()),n=null),l=null,a("Camera stopped.")},b=D(e=>{r(e)}),y=async e=>{if(!(!l||!n)){try{if(e.readyState>=HTMLMediaElement.HAVE_ENOUGH_DATA){const t=await l.detect(e);if(t.length>0){const[s]=t,o=s.rawValue||"",u=s.format||"";o&&b(o),_(o||"(no data)",u),a("Barcode detected.")}else a("Scanning...")}}catch(t){a(`Scan error: ${t.message||t}`)}d=requestAnimationFrame(()=>y(e))}},A=async()=>{if(!("BarcodeDetector"in window)){a("BarcodeDetector API is not supported in this browser.");return}try{a("Requesting camera access...");const e=await new Promise(t=>{let s=0;const o=()=>{const u=document.getElementById(g);if(u)return t(u);if(s+=1,s>60)return t(null);requestAnimationFrame(o)};o()});if(!e){a("Barcode preview not ready.");return}l=new BarcodeDetector({formats:v}),n=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}),e.srcObject=n,await e.play(),a("Scanning..."),y(e)}catch(e){console.error("[barcode] camera error:",e),a(`Camera error: ${e.message||e}`),w()}};I(()=>{w(),console.log("ðŸ”´ stop barcode scanner tag destroyed")}),A();const B=()=>i?p?`${i}

format: ${p}`:i:"";return m({class:"qr-panel"},m({class:"qr-preview"},M({id:g,playsInline:!0,muted:!0})),m({class:"qr-output"},F({class:"qr-label"},"Barcode Data"),E({class:"qr-text"},()=>B()||"(no scan yet)")),m({class:"qr-status"},()=>f))});export{T as B};
