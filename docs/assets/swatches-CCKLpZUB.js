import{i as Ee,r as $e,a as ke,b as qe,g as Oe,f as Le,s as Z,p as De,c as H,d as ee,h as ie,t as R,e as ce,o as le,j as y,k as D,l as de,m as Re,n as he,q as k,u as O,v as T,w as P,x as $,y as N,z as Te,A as Me,B as Ae,C as Pe,S as Fe,D as Ie,E as xe,F as Be,G as He,H as te,I as ue,J as We,K as I,L as Ve,M as Qe,N as Ue,O as je,P as Ke,Q as Ne,R as ze,T as Ge}from"./toast-DaPRlz4a.js";/* empty css               */function Je(n){const e=n.context;return Ee(n.templater)?$e(n):ke(n,n,e)}function L(n){if(!n)return qe;const e=Oe();if(!e)throw new Error("output must be used in render sync with a parent context");const t=Le(e);if(!t)throw new Error("output must be used in render sync fashion");if(n.wrapped===!0)return n;const a=(...r)=>{const s=t.ownerSupport;return Xe(r,n,s.context)};return a.wrapped=!0,a}function Xe(n,e,t){const a=t.state,r=a.newer.states,s=a.older?a.older.states:r,i=a.newest;Z(r,s);const c=e(...n);return Z(s,r),De.push([()=>{const d=i.context.global;if(d===void 0||d.deleted===!0){++H.locks,i.context.tagJsVar.processUpdate(i.context.value,i.context,i,[]),--H.locks,ee();return}++H.locks,Je(i),--H.locks,ee()},[]]),c}const Ye=/\d+/g,pe=n=>{if(!n)return"";const e=n.split("#").filter(Boolean),t=n.match(Ye)||[],a=[...e,...t].filter(r=>r);return a.length?a.reduce((r,s)=>s.length>r.length?s:r,""):""},Ze=(n,e)=>{if(!e)return[];const t=e.toLowerCase();return n.filter(a=>[a.qr_search_data,a.swatch_code,a.number,a.label,a.color_name].filter(s=>s!=null).map(s=>s.toString().toLowerCase()).some(s=>s.includes(t)))},et=/\d+/g,ge=n=>{if(!n)return"";const e=n.split("#").filter(Boolean),t=n.match(et)||[],a=[...e,...t].filter(r=>r);return a.length?a.reduce((r,s)=>s.length>r.length?s:r,""):""},tt=(n,e)=>{if(!e)return[];const t=e.toLowerCase();return n.filter(a=>[a.barcode_search_data,a.swatch_code,a.number,a.label,a.color_name].filter(s=>s!=null).map(s=>s.toString().toLowerCase()).some(s=>s.includes(t)))},at="modulepreload",nt=function(n,e){return new URL(n,e).href},ae={},rt=function(e,t,a){let r=Promise.resolve();if(t&&t.length>0){let i=function(p){return Promise.all(p.map(v=>Promise.resolve(v).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};const c=document.getElementsByTagName("link"),d=document.querySelector("meta[property=csp-nonce]"),h=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));r=i(t.map(p=>{if(p=nt(p,a),p in ae)return;ae[p]=!0;const v=p.endsWith(".css"),l=v?'[rel="stylesheet"]':"";if(!!a)for(let o=c.length-1;o>=0;o--){const f=c[o];if(f.href===p&&(!v||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${l}`))return;const _=document.createElement("link");if(_.rel=v?"stylesheet":at,v||(_.as="script"),_.crossOrigin="",_.href=p,h&&_.setAttribute("nonce",h),document.head.appendChild(_),v)return new Promise((o,f)=>{_.addEventListener("load",o),_.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${p}`)))})}))}function s(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return r.then(i=>{for(const c of i||[])c.status==="rejected"&&s(c.reason);return e().catch(s)})};class m{constructor(e,t,a,r,s){this._legacyCanvasSize=m.DEFAULT_CANVAS_SIZE,this._preferredCamera="environment",this._maxScansPerSecond=25,this._lastScanTimestamp=-1,this._destroyed=this._flashOn=this._paused=this._active=!1,this.$video=e,this.$canvas=document.createElement("canvas"),a&&typeof a=="object"?this._onDecode=t:(console.warn(a||r||s?"You're using a deprecated version of the QrScanner constructor which will be removed in the future":"Note that the type of the scan result passed to onDecode will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),this._legacyOnDecode=t),t=typeof a=="object"?a:{},this._onDecodeError=t.onDecodeError||(typeof a=="function"?a:this._onDecodeError),this._calculateScanRegion=t.calculateScanRegion||(typeof r=="function"?r:this._calculateScanRegion),this._preferredCamera=t.preferredCamera||s||this._preferredCamera,this._legacyCanvasSize=typeof a=="number"?a:typeof r=="number"?r:this._legacyCanvasSize,this._maxScansPerSecond=t.maxScansPerSecond||this._maxScansPerSecond,this._onPlay=this._onPlay.bind(this),this._onLoadedMetaData=this._onLoadedMetaData.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),this._updateOverlay=this._updateOverlay.bind(this),e.disablePictureInPicture=!0,e.playsInline=!0,e.muted=!0;let i=!1;if(e.hidden&&(e.hidden=!1,i=!0),document.body.contains(e)||(document.body.appendChild(e),i=!0),a=e.parentElement,t.highlightScanRegion||t.highlightCodeOutline){if(r=!!t.overlay,this.$overlay=t.overlay||document.createElement("div"),s=this.$overlay.style,s.position="absolute",s.display="none",s.pointerEvents="none",this.$overlay.classList.add("scan-region-highlight"),!r&&t.highlightScanRegion){this.$overlay.innerHTML='<svg class="scan-region-highlight-svg" viewBox="0 0 238 238" preserveAspectRatio="none" style="position:absolute;width:100%;height:100%;left:0;top:0;fill:none;stroke:#e9b213;stroke-width:4;stroke-linecap:round;stroke-linejoin:round"><path d="M31 2H10a8 8 0 0 0-8 8v21M207 2h21a8 8 0 0 1 8 8v21m0 176v21a8 8 0 0 1-8 8h-21m-176 0H10a8 8 0 0 1-8-8v-21"/></svg>';try{this.$overlay.firstElementChild.animate({transform:["scale(.98)","scale(1.01)"]},{duration:400,iterations:1/0,direction:"alternate",easing:"ease-in-out"})}catch{}a.insertBefore(this.$overlay,this.$video.nextSibling)}t.highlightCodeOutline&&(this.$overlay.insertAdjacentHTML("beforeend",'<svg class="code-outline-highlight" preserveAspectRatio="none" style="display:none;width:100%;height:100%;fill:none;stroke:#e9b213;stroke-width:5;stroke-dasharray:25;stroke-linecap:round;stroke-linejoin:round"><polygon/></svg>'),this.$codeOutlineHighlight=this.$overlay.lastElementChild)}this._scanRegion=this._calculateScanRegion(e),requestAnimationFrame(()=>{let c=window.getComputedStyle(e);c.display==="none"&&(e.style.setProperty("display","block","important"),i=!0),c.visibility!=="visible"&&(e.style.setProperty("visibility","visible","important"),i=!0),i&&(console.warn("QrScanner has overwritten the video hiding style to avoid Safari stopping the playback."),e.style.opacity="0",e.style.width="0",e.style.height="0",this.$overlay&&this.$overlay.parentElement&&this.$overlay.parentElement.removeChild(this.$overlay),delete this.$overlay,delete this.$codeOutlineHighlight),this.$overlay&&this._updateOverlay()}),e.addEventListener("play",this._onPlay),e.addEventListener("loadedmetadata",this._onLoadedMetaData),document.addEventListener("visibilitychange",this._onVisibilityChange),window.addEventListener("resize",this._updateOverlay),this._qrEnginePromise=m.createQrEngine()}static set WORKER_PATH(e){console.warn("Setting QrScanner.WORKER_PATH is not required and not supported anymore. Have a look at the README for new setup instructions.")}static async hasCamera(){try{return!!(await m.listCameras(!1)).length}catch{return!1}}static async listCameras(e=!1){if(!navigator.mediaDevices)return[];let t=async()=>(await navigator.mediaDevices.enumerateDevices()).filter(r=>r.kind==="videoinput"),a;try{e&&(await t()).every(r=>!r.label)&&(a=await navigator.mediaDevices.getUserMedia({audio:!1,video:!0}))}catch{}try{return(await t()).map((r,s)=>({id:r.deviceId,label:r.label||(s===0?"Default Camera":`Camera ${s+1}`)}))}finally{a&&(console.warn("Call listCameras after successfully starting a QR scanner to avoid creating a temporary video stream"),m._stopVideoStream(a))}}async hasFlash(){let e;try{if(this.$video.srcObject){if(!(this.$video.srcObject instanceof MediaStream))return!1;e=this.$video.srcObject}else e=(await this._getCameraStream()).stream;return"torch"in e.getVideoTracks()[0].getSettings()}catch{return!1}finally{e&&e!==this.$video.srcObject&&(console.warn("Call hasFlash after successfully starting the scanner to avoid creating a temporary video stream"),m._stopVideoStream(e))}}isFlashOn(){return this._flashOn}async toggleFlash(){this._flashOn?await this.turnFlashOff():await this.turnFlashOn()}async turnFlashOn(){if(!this._flashOn&&!this._destroyed&&(this._flashOn=!0,this._active&&!this._paused))try{if(!await this.hasFlash())throw"No flash available";await this.$video.srcObject.getVideoTracks()[0].applyConstraints({advanced:[{torch:!0}]})}catch(e){throw this._flashOn=!1,e}}async turnFlashOff(){this._flashOn&&(this._flashOn=!1,await this._restartVideoStream())}destroy(){this.$video.removeEventListener("loadedmetadata",this._onLoadedMetaData),this.$video.removeEventListener("play",this._onPlay),document.removeEventListener("visibilitychange",this._onVisibilityChange),window.removeEventListener("resize",this._updateOverlay),this._destroyed=!0,this._flashOn=!1,this.stop(),m._postWorkerMessage(this._qrEnginePromise,"close")}async start(){if(this._destroyed)throw Error("The QR scanner can not be started as it had been destroyed.");if((!this._active||this._paused)&&(window.location.protocol!=="https:"&&console.warn("The camera stream is only accessible if the page is transferred via https."),this._active=!0,!document.hidden))if(this._paused=!1,this.$video.srcObject)await this.$video.play();else try{let{stream:e,facingMode:t}=await this._getCameraStream();!this._active||this._paused?m._stopVideoStream(e):(this._setVideoMirror(t),this.$video.srcObject=e,await this.$video.play(),this._flashOn&&(this._flashOn=!1,this.turnFlashOn().catch(()=>{})))}catch(e){if(!this._paused)throw this._active=!1,e}}stop(){this.pause(),this._active=!1}async pause(e=!1){if(this._paused=!0,!this._active)return!0;this.$video.pause(),this.$overlay&&(this.$overlay.style.display="none");let t=()=>{this.$video.srcObject instanceof MediaStream&&(m._stopVideoStream(this.$video.srcObject),this.$video.srcObject=null)};return e?(t(),!0):(await new Promise(a=>setTimeout(a,300)),this._paused?(t(),!0):!1)}async setCamera(e){e!==this._preferredCamera&&(this._preferredCamera=e,await this._restartVideoStream())}static async scanImage(e,t,a,r,s=!1,i=!1){let c,d=!1;t&&("scanRegion"in t||"qrEngine"in t||"canvas"in t||"disallowCanvasResizing"in t||"alsoTryWithoutScanRegion"in t||"returnDetailedScanResult"in t)?(c=t.scanRegion,a=t.qrEngine,r=t.canvas,s=t.disallowCanvasResizing||!1,i=t.alsoTryWithoutScanRegion||!1,d=!0):console.warn(t||a||r||s||i?"You're using a deprecated api for scanImage which will be removed in the future.":"Note that the return type of scanImage will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),t=!!a;try{let h,p;[a,h]=await Promise.all([a||m.createQrEngine(),m._loadImage(e)]),[r,p]=m._drawToCanvas(h,c,r,s);let v;if(a instanceof Worker){let l=a;t||m._postWorkerMessageSync(l,"inversionMode","both"),v=await new Promise((u,_)=>{let o,f,w,E=-1;f=S=>{S.data.id===E&&(l.removeEventListener("message",f),l.removeEventListener("error",w),clearTimeout(o),S.data.data!==null?u({data:S.data.data,cornerPoints:m._convertPoints(S.data.cornerPoints,c)}):_(m.NO_QR_CODE_FOUND))},w=S=>{l.removeEventListener("message",f),l.removeEventListener("error",w),clearTimeout(o),_("Scanner error: "+(S?S.message||S:"Unknown Error"))},l.addEventListener("message",f),l.addEventListener("error",w),o=setTimeout(()=>w("timeout"),1e4);let q=p.getImageData(0,0,r.width,r.height);E=m._postWorkerMessageSync(l,"decode",q,[q.data.buffer])})}else v=await Promise.race([new Promise((l,u)=>window.setTimeout(()=>u("Scanner error: timeout"),1e4)),(async()=>{try{var[l]=await a.detect(r);if(!l)throw m.NO_QR_CODE_FOUND;return{data:l.rawValue,cornerPoints:m._convertPoints(l.cornerPoints,c)}}catch(u){if(l=u.message||u,/not implemented|service unavailable/.test(l))return m._disableBarcodeDetector=!0,m.scanImage(e,{scanRegion:c,canvas:r,disallowCanvasResizing:s,alsoTryWithoutScanRegion:i});throw`Scanner error: ${l}`}})()]);return d?v:v.data}catch(h){if(!c||!i)throw h;let p=await m.scanImage(e,{qrEngine:a,canvas:r,disallowCanvasResizing:s});return d?p:p.data}finally{t||m._postWorkerMessage(a,"close")}}setGrayscaleWeights(e,t,a,r=!0){m._postWorkerMessage(this._qrEnginePromise,"grayscaleWeights",{red:e,green:t,blue:a,useIntegerApproximation:r})}setInversionMode(e){m._postWorkerMessage(this._qrEnginePromise,"inversionMode",e)}static async createQrEngine(e){if(e&&console.warn("Specifying a worker path is not required and not supported anymore."),e=()=>rt(()=>import("./qr-scanner-worker.min-D85Z9gVD.js"),[],import.meta.url).then(a=>a.createWorker()),!(!m._disableBarcodeDetector&&"BarcodeDetector"in window&&BarcodeDetector.getSupportedFormats&&(await BarcodeDetector.getSupportedFormats()).includes("qr_code")))return e();let t=navigator.userAgentData;return t&&t.brands.some(({brand:a})=>/Chromium/i.test(a))&&/mac ?OS/i.test(t.platform)&&await t.getHighEntropyValues(["architecture","platformVersion"]).then(({architecture:a,platformVersion:r})=>/arm/i.test(a||"arm")&&13<=parseInt(r||"13")).catch(()=>!0)?e():new BarcodeDetector({formats:["qr_code"]})}_onPlay(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay(),this.$overlay&&(this.$overlay.style.display=""),this._scanFrame()}_onLoadedMetaData(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay()}_onVisibilityChange(){document.hidden?this.pause():this._active&&this.start()}_calculateScanRegion(e){let t=Math.round(.6666666666666666*Math.min(e.videoWidth,e.videoHeight));return{x:Math.round((e.videoWidth-t)/2),y:Math.round((e.videoHeight-t)/2),width:t,height:t,downScaledWidth:this._legacyCanvasSize,downScaledHeight:this._legacyCanvasSize}}_updateOverlay(){requestAnimationFrame(()=>{if(this.$overlay){var e=this.$video,t=e.videoWidth,a=e.videoHeight,r=e.offsetWidth,s=e.offsetHeight,i=e.offsetLeft,c=e.offsetTop,d=window.getComputedStyle(e),h=d.objectFit,p=t/a,v=r/s;switch(h){case"none":var l=t,u=a;break;case"fill":l=r,u=s;break;default:(h==="cover"?p>v:p<v)?(u=s,l=u*p):(l=r,u=l/p),h==="scale-down"&&(l=Math.min(l,t),u=Math.min(u,a))}var[_,o]=d.objectPosition.split(" ").map((w,E)=>{const q=parseFloat(w);return w.endsWith("%")?(E?s-u:r-l)*q/100:q});d=this._scanRegion.width||t,v=this._scanRegion.height||a,h=this._scanRegion.x||0;var f=this._scanRegion.y||0;p=this.$overlay.style,p.width=`${d/t*l}px`,p.height=`${v/a*u}px`,p.top=`${c+o+f/a*u}px`,a=/scaleX\(-1\)/.test(e.style.transform),p.left=`${i+(a?r-_-l:_)+(a?t-h-d:h)/t*l}px`,p.transform=e.style.transform}})}static _convertPoints(e,t){if(!t)return e;let a=t.x||0,r=t.y||0,s=t.width&&t.downScaledWidth?t.width/t.downScaledWidth:1;t=t.height&&t.downScaledHeight?t.height/t.downScaledHeight:1;for(let i of e)i.x=i.x*s+a,i.y=i.y*t+r;return e}_scanFrame(){!this._active||this.$video.paused||this.$video.ended||("requestVideoFrameCallback"in this.$video?this.$video.requestVideoFrameCallback.bind(this.$video):requestAnimationFrame)(async()=>{if(!(1>=this.$video.readyState)){var e=Date.now()-this._lastScanTimestamp,t=1e3/this._maxScansPerSecond;e<t&&await new Promise(r=>setTimeout(r,t-e)),this._lastScanTimestamp=Date.now();try{var a=await m.scanImage(this.$video,{scanRegion:this._scanRegion,qrEngine:this._qrEnginePromise,canvas:this.$canvas})}catch(r){if(!this._active)return;this._onDecodeError(r)}!m._disableBarcodeDetector||await this._qrEnginePromise instanceof Worker||(this._qrEnginePromise=m.createQrEngine()),a?(this._onDecode?this._onDecode(a):this._legacyOnDecode&&this._legacyOnDecode(a.data),this.$codeOutlineHighlight&&(clearTimeout(this._codeOutlineHighlightRemovalTimeout),this._codeOutlineHighlightRemovalTimeout=void 0,this.$codeOutlineHighlight.setAttribute("viewBox",`${this._scanRegion.x||0} ${this._scanRegion.y||0} ${this._scanRegion.width||this.$video.videoWidth} ${this._scanRegion.height||this.$video.videoHeight}`),this.$codeOutlineHighlight.firstElementChild.setAttribute("points",a.cornerPoints.map(({x:r,y:s})=>`${r},${s}`).join(" ")),this.$codeOutlineHighlight.style.display="")):this.$codeOutlineHighlight&&!this._codeOutlineHighlightRemovalTimeout&&(this._codeOutlineHighlightRemovalTimeout=setTimeout(()=>this.$codeOutlineHighlight.style.display="none",100))}this._scanFrame()})}_onDecodeError(e){e!==m.NO_QR_CODE_FOUND&&console.log(e)}async _getCameraStream(){if(!navigator.mediaDevices)throw"Camera not found.";let e=/^(environment|user)$/.test(this._preferredCamera)?"facingMode":"deviceId",t=[{width:{min:1024}},{width:{min:768}},{}],a=t.map(r=>Object.assign({},r,{[e]:{exact:this._preferredCamera}}));for(let r of[...a,...t])try{let s=await navigator.mediaDevices.getUserMedia({video:r,audio:!1}),i=this._getFacingMode(s)||(r.facingMode?this._preferredCamera:this._preferredCamera==="environment"?"user":"environment");return{stream:s,facingMode:i}}catch{}throw"Camera not found."}async _restartVideoStream(){let e=this._paused;await this.pause(!0)&&!e&&this._active&&await this.start()}static _stopVideoStream(e){for(let t of e.getTracks())t.stop(),e.removeTrack(t)}_setVideoMirror(e){this.$video.style.transform="scaleX("+(e==="user"?-1:1)+")"}_getFacingMode(e){return(e=e.getVideoTracks()[0])?/rear|back|environment/i.test(e.label)?"environment":/front|user|face/i.test(e.label)?"user":null:null}static _drawToCanvas(e,t,a,r=!1){a=a||document.createElement("canvas");let s=t&&t.x?t.x:0,i=t&&t.y?t.y:0,c=t&&t.width?t.width:e.videoWidth||e.width,d=t&&t.height?t.height:e.videoHeight||e.height;return r||(r=t&&t.downScaledWidth?t.downScaledWidth:c,t=t&&t.downScaledHeight?t.downScaledHeight:d,a.width!==r&&(a.width=r),a.height!==t&&(a.height=t)),t=a.getContext("2d",{alpha:!1}),t.imageSmoothingEnabled=!1,t.drawImage(e,s,i,c,d,0,0,a.width,a.height),[a,t]}static async _loadImage(e){if(e instanceof Image)return await m._awaitImageLoad(e),e;if(e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof SVGImageElement||"OffscreenCanvas"in window&&e instanceof OffscreenCanvas||"ImageBitmap"in window&&e instanceof ImageBitmap)return e;if(e instanceof File||e instanceof Blob||e instanceof URL||typeof e=="string"){let t=new Image;t.src=e instanceof File||e instanceof Blob?URL.createObjectURL(e):e.toString();try{return await m._awaitImageLoad(t),t}finally{(e instanceof File||e instanceof Blob)&&URL.revokeObjectURL(t.src)}}else throw"Unsupported image type."}static async _awaitImageLoad(e){e.complete&&e.naturalWidth!==0||await new Promise((t,a)=>{let r=s=>{e.removeEventListener("load",r),e.removeEventListener("error",r),s instanceof ErrorEvent?a("Image load error"):t()};e.addEventListener("load",r),e.addEventListener("error",r)})}static async _postWorkerMessage(e,t,a,r){return m._postWorkerMessageSync(await e,t,a,r)}static _postWorkerMessageSync(e,t,a,r){if(!(e instanceof Worker))return-1;let s=m._workerMessageId++;return e.postMessage({id:s,type:t,data:a},r),s}}m.DEFAULT_CANVAS_SIZE=400;m.NO_QR_CODE_FOUND="No QR code found";m._disableBarcodeDetector=!1;m._workerMessageId=0;m.WORKER_PATH=new URL(""+new URL("qr-scanner-worker.min-PJMWJc5V.js",import.meta.url).href,import.meta.url).toString();const st=ie("video"),z=R(({onResult:n})=>{z.updates(h=>{[{onResult:n}]=h,n=L(n)}),n=L(n);let e=null,t="Idle.",a="";const r=`qrPreview-${Math.random().toString(36).slice(2,9)}`,s=h=>{console.log("[qr] status:",h),t=h},i=()=>{e&&(console.log("[qr] stop"),e.stop(),e.destroy(),e=null,s("Camera stopped."))},c=ce(h=>{console.log("[qr] decode result:",h),a=(h==null?void 0:h.data)||"",s("QR detected."),n(a)}),d=async()=>{try{console.log("[qr] start"),s("Requesting camera access...");const h=await new Promise((p,v)=>{let l=0;const u=()=>{const _=document.getElementById(r);if(_)return p(_);if(l+=1,l>30)return v(new Error("QR preview element not found"));requestAnimationFrame(u)};u()});console.log("[qr] preview element:",h),e=new m(h,c,{highlightScanRegion:!0,highlightCodeOutline:!0,preferredCamera:"environment"}),console.log("[qr] scanner created:",e),await e.start(),console.log("[qr] scanner started"),s("Scanning...")}catch(h){console.error("[qr] camera error:",h),s(`Camera error: ${h.message||h}`)}};return R.onDestroy(()=>{i(),console.log("ðŸ”´ stop scanner")}),le(()=>{d()}),y({class:"qr-panel"},y({class:"qr-preview"},st({id:r,playsInline:!0,muted:!0})),y({class:"qr-output"},D({class:"qr-label"},"QR Text"),de({class:"qr-text"},()=>a||"(no scan yet)")),y({class:"qr-status"},()=>t))}),x=R(({title:n,onClose:e,onApply:t,applyLabel:a,ScannerPanel:r})=>{x.updates(u=>{[{title:n,onClose:e,onApply:t,applyLabel:a,ScannerPanel:r}]=u,e=L(e),t&&(t=L(t)),typeof r!="function"&&(r=z)}),e=L(e),t&&(t=L(t)),typeof r!="function"&&(r=z);const s=`qr-modal-${Math.random().toString(36).slice(2,9)}`,i=()=>{const u=document.getElementById(s);u!=null&&u.close&&u.close()};let c="";const d=u=>{c=u||"",t(c)},h=()=>{t&&t(c),i()};return Re({id:s,class:"qr-modal",open:!0,onClick:u=>{u.target.nodeName==="DIALOG"&&i()},onClose:()=>{e()},onCancel:u=>{u!=null&&u.preventDefault&&u.preventDefault(),i()}},y({class:"qr-modal-card"},y({class:"qr-modal-header"},he({class:"qr-modal-title"},n),y({class:"qr-modal-actions"},u=>c&&k({type:"button",class:"qr-modal-apply",onClick:h},a||"Apply"),k({type:"button",class:"qr-modal-close","aria-label":"Close",onClick:()=>i()},"Close"))),y({class:"qr-modal-body"},u=>r({onResult:d}))))}),ot=ie("video"),Y=R(({onResult:n})=>{Y.updates(o=>{[{onResult:n}]=o,n=L(n)}),n=L(n);let e="Idle.",t="",a="",r=null,s=null,i=null;const c=`barcodePreview-${Math.random().toString(36).slice(2,9)}`,d=o=>{console.log("[barcode] status:",o),e=o},h=(o,f)=>{t=o,a=f||""},p=()=>{i&&(cancelAnimationFrame(i),i=null),s&&(s.getTracks().forEach(o=>o.stop()),s=null),r=null,d("Camera stopped.")},v=ce(o=>{n(o)}),l=async o=>{if(!(!r||!s)){try{if(o.readyState>=HTMLMediaElement.HAVE_ENOUGH_DATA){const f=await r.detect(o);if(f.length>0){const[w]=f,E=w.rawValue||"",q=w.format||"";E&&v(E),h(E||"(no data)",q),d("Barcode detected.")}else d("Scanning...")}}catch(f){d(`Scan error: ${f.message||f}`)}i=requestAnimationFrame(()=>l(o))}},u=async()=>{if(!("BarcodeDetector"in window)){d("BarcodeDetector API is not supported in this browser.");return}try{d("Requesting camera access...");const o=await new Promise((f,w)=>{let E=0;const q=()=>{const S=document.getElementById(c);if(S)return f(S);if(E+=1,E>30)return w(new Error("Barcode preview element not found"));requestAnimationFrame(q)};q()});r=new BarcodeDetector({formats:["code_128","code_39","code_93","ean_13","ean_8","itf","upc_a","upc_e","qr_code"]}),s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}),o.srcObject=s,await o.play(),d("Scanning..."),l(o)}catch(o){console.error("[barcode] camera error:",o),d(`Camera error: ${o.message||o}`),p()}};R.onDestroy(()=>{p(),console.log("ðŸ”´ stop barcode scanner")}),le(()=>{u()});const _=()=>t?a?`${t}

format: ${a}`:t:"";return y({class:"qr-panel"},y({class:"qr-preview"},ot({id:c,playsInline:!0,muted:!0})),y({class:"qr-output"},D({class:"qr-label"},"Barcode Data"),de({class:"qr-text"},()=>_()||"(no scan yet)")),y({class:"qr-status"},()=>e))}),me=["PETG","PLA","TPU"],A=["Fireguys","Apples"],fe=n=>/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(n),F=(n,e,t)=>{n[e]=t},it=n=>{if(!n)return"";try{return new URL(n).hostname.replace(/^www\./,"")}catch{return n.replace(/^https?:\/\//,"").split("/")[0]}},b=(n,e,{trim:t=!1}={})=>({onChange:a=>F(n,e,t?a.target.value.trim():a.target.value),onKeyup:a=>F(n,e,t?a.target.value.trim():a.target.value)}),W=(n,e)=>({onChange:t=>F(n,e,t.target.value),onKeyup:t=>F(n,e,t.target.value)}),j=(n,e)=>({onChange:t=>{var a;return F(n,e,((a=t==null?void 0:t.target)==null?void 0:a.value)||"")}}),ye=R((n,e,t,a,r,s)=>{ye.updates(o=>{[n,e,t,a,r,s]=o}),t=L(t);let i=!1,c=!1,d=!1;const h=()=>{d=!0},p=()=>{d=!0},v=()=>{if(!r||!d)return;const o=r(),f=()=>{d=!1,t(e)};if(o&&typeof o.then=="function"){o.then(f);return}f()},l=()=>{s&&s(e)},u=o=>{const f=pe(o||"");n.qr_search_data=f||o||"",i=!1,h()},_=o=>{const f=ge(o||"");n.barcode_search_data=f||o||"",c=!1,h()};return y.class`swatch-card`(o=>i&&x({title:"Scan QR for this spool",onClose:()=>i=!1,onApply:u,applyLabel:"Apply QR"}),o=>c&&x({title:"Scan barcode for this spool",onClose:()=>c=!1,onApply:_,applyLabel:"Apply barcode",ScannerPanel:Y}),y.class`edit-card-header`(D.class`edit-card-title`(o=>`Swatch ${n.number||"-"}`),y.class`edit-card-actions`(r?k.type`button`.class`add-button`.disabled(o=>!d).onClick(v)("ðŸ’¾ Save"):null,s?k.type`button`.class`ghost-button`.onClick(l)("ðŸ§¬ Duplicate"):null,k.type`button`.class`edit-card-toggle`.onClick(()=>t(e)).attr("aria-label","Stop editing swatch")("Done"))),O("Number",T.type`number`.value(o=>n.number??"").onChange(W(n,"number").onChange).onKeyup(W(n,"number").onKeyup)()),y.class`fields`.onInput(p).onChange(p).onKeydown(o=>{o.key==="Enter"&&(o.preventDefault(),v())})(O("Hex Color",y.class`hex-input-row`(T.type`color`.value(o=>fe(n.hex)?n.hex:"#000000").style`width:56px; min-width:56px; padding:0; height:42px;`.onChange(o=>{h(),F(n,"hex",o.target.value.trim())})(),T.value(o=>n.hex??"").style`flex:1;`.onChange(b(n,"hex",{trim:!0}).onChange).onKeyup(b(n,"hex",{trim:!0}).onKeyup)())),O("Spool Inventory",T.type`number`.value(o=>n.spool_inventory??"").onChange(W(n,"spool_inventory").onChange).onKeyup(W(n,"spool_inventory").onKeyup)()),O("Label",T.value(o=>n.label??"").onChange(b(n,"label").onChange).onKeyup(b(n,"label").onKeyup)()),O("Manufacturer",P.onChange(j(n,"manufacturer").onChange)($.value``.selected(o=>!n.manufacturer)("Select manufacturer"),...(a||[]).map(o=>$.value(o).selected(f=>n.manufacturer===o)(o)))),O("Material Type",P.onChange(j(n,"material_type").onChange)($.value``.selected(o=>!n.material_type)("Select material"),...me.map(o=>$.value(o).selected(f=>n.material_type===o)(o)))),O("Location",P.onChange(j(n,"location").onChange)($.value``.selected(o=>!n.location)("Select location"),...A.map(o=>$.value(o).selected(f=>n.location===o)(o)))),O("Color name",T.value(o=>n.color_name??"").onChange(b(n,"color_name").onChange).onKeyup(b(n,"color_name").onKeyup)()),O("Swatch code",T.value(o=>n.swatch_code??"").onChange(b(n,"swatch_code").onChange).onKeyup(b(n,"swatch_code").onKeyup)()),O("QR Search Data",y.class`qr-input-row`(T.class`qr-edit-input`.value(o=>n.qr_search_data??"").onChange(b(n,"qr_search_data").onChange).onKeyup(b(n,"qr_search_data").onKeyup)(),k.type`button`.class`qr-scan-button`.onClick(()=>i=!0)("Scan QR"))),O("Bar Code",y.class`qr-input-row`(T.class`qr-edit-input`.value(o=>n.barcode_search_data??"").onChange(b(n,"barcode_search_data").onChange).onKeyup(b(n,"barcode_search_data").onKeyup)(),k.type`button`.class`qr-scan-button`.onClick(()=>c=!0)("Scan barcode"))),O("URL",T.type`url`.value(o=>n.url??"").onChange(b(n,"url").onChange).onKeyup(b(n,"url").onKeyup)())))}),ve=R((n,e,t)=>(ve.updates(a=>{[n,e,t]=a}),t=L(t),y.class`summary-row`(y(a=>n.number||"-"),y.class`summary-swatch`(y.class`summary-chip`.style(a=>`background:${fe(n.hex)?n.hex:""};`)(),D.class`summary-swatch-name`(a=>n.color_name||"Unnamed")),y.class`summary-details`(y.class`summary-title-row`(N(a=>n.label||"Untitled"),k.type`button`.class`summary-edit-button`.onClick(()=>{t(e)})({"aria-label":"Edit swatch"},"âœï¸")),a=>{const r=[];if(n.manufacturer?r.push(D.class`summary-meta-item`(`Maker: ${n.manufacturer}`)):r.push(D.class`summary-meta-item`("Maker: N/A")),n.spool_inventory!==void 0&&n.spool_inventory!==""?r.push(D.class`summary-meta-item`(`Spools: ${n.spool_inventory}`)):r.push(D.class`summary-meta-item`("Spools: N/A")),n.url){const s=it(n.url);r.push(D.class`summary-meta-item`(Te.href(n.url).attr("target","_blank").attr("rel","noopener noreferrer")(s||n.url)))}return r.length?y.class`summary-meta`(...r):""})))),_e=R((n,e,t,a,r,s,i)=>(_e.updates(c=>{[n,e,t,a,r,s,i]=c,a=L(a)}),a=L(a),Me(c=>t===e?ye(n,e,a,r,s,i):ve(n,e,a))));let Q=null;const ct=n=>{Q=Q===n?null:n},ne=n=>{Q=n},we=R((n,e)=>{we.updates(g=>{[n,e]=g});let t=[],a=!1,r=!1;const s=()=>{t.unshift(ut(A[0]||"")),ne(0)},i=()=>mt(t),c=g=>{const C=t[g];if(!C)return;const B={...C,number:0,location:C.location||A[0]||""};t.splice(g+1,0,B),ne(g+1)};let d=!1,h=!1,p="",v="",l="",u="",_="",o="",f="";const w="__unassigned__",E=g=>{p=g||"",v=pe(p),d=!1},q=g=>{l=pt(g),u=ge(l)||l,h=!1,console.log("app barcode apply",g)},S=()=>ft(t,{manufacturerFilter:_,materialTypeFilter:o,locationFilter:f,unassignedLocation:w,qrToken:v,barcodeToken:u}),Ce=()=>yt(S(),[...A,"Unassigned"]);return(()=>{if(!te){console.debug("SwatchApp load skipped: no loader provided");return}a||r||(r=!0,console.debug("SwatchApp loading swatches..."),R.promise=te().then(g=>{console.debug("SwatchApp load complete",{count:(g==null?void 0:g.length)||0}),t=se(g||[]),a=!0}).catch(g=>{console.error("SwatchApp load failed",g),t=se([]),a=!0}).finally(()=>{r=!1}))})(),[Ae(Fe(e),Ie("Swatch Editor"),xe("Edit swatches in place. Changes are saved directly to Firestore.")),Pe(Be.class`panel`(y.class`meta`(y.class`controls`(y.class`controls-group`(k({id:"addSwatchButton",class:"add-button",type:"button",onClick:s},"âž• Add swatch"),k({id:"qrSearchButton",class:"add-button",type:"button",onClick:()=>d=!0},"ðŸ“· Search by QR read"),k({id:"barcodeSearchButton",class:"add-button",type:"button",onClick:()=>h=!0},"ðŸ”Ž Search by barcode read")),y.class`controls-group`(P({value:()=>_??"",onChange:g=>{var C;return _=((C=g==null?void 0:g.target)==null?void 0:C.value)||""}},$({value:""},"Filter by manufacturer"),...(n||[]).map(g=>$({value:g},g))),P({value:()=>o??"",onChange:g=>{var C;return o=((C=g==null?void 0:g.target)==null?void 0:C.value)||""}},$({value:""},"Filter by material type"),...me.map(g=>$({value:g},g))),P({value:()=>f??"",onChange:g=>{var C;return f=((C=g==null?void 0:g.target)==null?void 0:C.value)||""}},$({value:""},"Filter by location"),...A.map(g=>$({value:g},g)),$({value:w},"Unassigned")),y.id`count`(g=>`${S().length} swatches`)))),g=>d&&x({title:"Search by QR read",onClose:()=>{d=!1},onApply:E,applyLabel:"Apply QR"}),g=>h&&x({title:"Search by barcode read",onClose:()=>h=!1,onApply:q,applyLabel:"Apply barcode",ScannerPanel:Y}),y({class:"qr-search-pill",hidden:()=>!p},D.class`qr-label`("Active QR search"),N.class`qr-value`(()=>p||"(empty)"),k({type:"button",class:"qr-clear-button",onClick:()=>{p="",v=""}},"Clear search")),y({class:"qr-search-pill",hidden:()=>!l},D.class`qr-label`("Active barcode search"),N.class`qr-value`(()=>l||"(empty)"),k({type:"button",class:"qr-clear-button",onClick:()=>{l="",u=""}},"Clear search")),y.id`summaryList`.class`summary-list`(g=>Ce().map(([C,B])=>y.class`location-group`(he.class`location-title`(`${C} (${B.length})`),...B.map(({item:U,index:be})=>_e(U,be,Q,ct,n,i,c).key(U.number||U)))))))]}),lt=n=>A.includes(n)?n:"",dt=n=>(Array.isArray(n)?n:[]).map(e=>({...e,location:lt(e.location)})).sort((e,t)=>(Number(e.number)||0)-(Number(t.number)||0)),ht=n=>n.map(e=>{const t={number:Number(e.number)||0,label:e.label||""};return e.color_name&&(t.color_name=e.color_name),e.manufacturer&&(t.manufacturer=e.manufacturer),e.material_type&&(t.material_type=e.material_type),e.swatch_code&&(t.swatch_code=e.swatch_code),e.qr_search_data&&(t.qr_search_data=e.qr_search_data),e.barcode_search_data&&(t.barcode_search_data=e.barcode_search_data),e.hex&&(t.hex=e.hex),e.url&&(t.url=e.url),e.location&&(t.location=e.location),e.spool_inventory!==void 0&&e.spool_inventory!==""&&(t.spool_inventory=Number(e.spool_inventory)||0),t}),ut=(n="")=>({number:0,label:"",manufacturer:"",material_type:"",color_name:"",swatch_code:"",qr_search_data:"",barcode_search_data:"",hex:"",url:"",spool_inventory:1,location:n}),pt=n=>n?n.trim():"",re=(n,e)=>!e||(n||"").toLowerCase()===e.toLowerCase(),gt=(n,e,t)=>e?e===t?!n:(n||"").toLowerCase()===e.toLowerCase():!0,se=n=>{const e=dt(n);return console.debug("Swatches loaded",{count:e.length}),e},mt=n=>He(ht(n)).catch(e=>{console.error("Failed to save swatches",e),alert("Save failed. Check the console for details.")}),ft=(n,e)=>n.reduce((t,a,r)=>{const s=re(a.manufacturer,e.manufacturerFilter),i=re(a.material_type,e.materialTypeFilter),c=gt(a.location,e.locationFilter,e.unassignedLocation),d=!e.qrToken||Ze([a],e.qrToken).length>0,h=!e.barcodeToken||tt([a],e.barcodeToken).length>0;return s&&i&&c&&d&&h&&t.push({item:a,index:r}),t},[]),yt=(n,e)=>{const t=new Map;return e.forEach(a=>{t.set(a,[])}),n.forEach(a=>{const r=a.item.location||e[e.length-1];t.has(r)||t.set(r,[]),t.get(r).push(a)}),Array.from(t.entries()).filter(([,a])=>a.length)},G={current:document.getElementById("swatchApp")};let J=ue.map(n=>n),M=null,K=!1,X=!1;const Se=()=>We().catch(n=>{console.error("Firebase sign-out failed",n),I.error("Sign out failed. Try again.")}),vt=R(()=>we(J,Se)),oe=(n="")=>{if(!G.current||X)return;const e=ze(G);e&&(e.replaceChildren(),Ge(vt,e),X=!0)},V=(n,e,t="")=>{console.debug("mountSso",{status:n,userEmail:e,reason:t}),Ve({rootRef:G,status:n,userEmail:e,adminEmail:"",onSignIn:()=>je().catch(a=>{console.error("Firebase sign-in failed",a),I.error("Sign in failed. Try again.")}),onSignOut:Se,setAppMounted:a=>{X=a}})};V("loading","","initial");const _t=async()=>{const{redirectError:n}=await Qe();n&&I.error("Sign-in failed after redirect. Try again."),Ue(async e=>{if(console.debug("auth changed",{userEmail:(e==null?void 0:e.email)||null}),K=!1,!e){M&&(M(),M=null),V("login","","auth:logged-out");return}let t=!1;try{t=await Ke(e.email||"")}catch(a){console.error("Failed to load admin list",a),I.error("Unable to verify access. Check Firestore rules."),V("denied",e.email||"","auth:permissions");return}if(!t){M&&(M(),M=null),I.error(`Signed in as ${e.email||"unknown"} but not authorized.`),V("denied",e.email||"","auth:denied");return}K=!0,M||(M=Ne(a=>{if(console.debug("manufacturers update",{count:(a==null?void 0:a.length)||0}),Array.isArray(a)&&a.length?J=a:J=ue.map(r=>r),K){oe("manufacturers:update");return}})),oe("auth:authorized")})};_t();
